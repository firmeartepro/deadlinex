<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeadlineX - Gerenciador de Prazos</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .priority-high { border-left: 4px solid #ef4444; }
        .priority-normal { border-left: 4px solid #3b82f6; }
        .priority-low { border-left: 4px solid #10b981; }
        
        .category-saude { background: linear-gradient(45deg, #ef4444, #f87171); }
        .category-trabalho { background: linear-gradient(45deg, #3b82f6, #60a5fa); }
        .category-aniversarios { background: linear-gradient(45deg, #f59e0b, #fbbf24); }
        .category-outros { background: linear-gradient(45deg, #8b5cf6, #a78bfa); }
        
        .deadline-urgent { animation: pulse 2s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .modal-overlay {
            backdrop-filter: blur(4px);
        }
        
        .calendar-day {
            min-height: 120px;
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            background-color: #f9fafb;
        }
        
        .calendar-day.today {
            background-color: #eff6ff;
            border-color: #3b82f6;
        }
        
        .calendar-day.other-month {
            color: #9ca3af;
            background-color: #f9fafb;
        }
        
        .calendar-event {
            font-size: 0.75rem;
            padding: 2px 6px;
            margin: 1px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .calendar-event:hover {
            transform: scale(1.02);
        }
        
        .calendar-event.high {
            background-color: #fee2e2;
            color: #dc2626;
            border-left: 3px solid #dc2626;
        }
        
        .calendar-event.normal {
            background-color: #dbeafe;
            color: #2563eb;
            border-left: 3px solid #2563eb;
        }
        
        .calendar-event.low {
            background-color: #d1fae5;
            color: #059669;
            border-left: 3px solid #059669;
        }
        
        .calendar-event.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-clock text-2xl"></i>
                    <h1 class="text-2xl font-bold">DeadlineX</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="userEmail" class="text-sm opacity-90"></span>
                    <button id="logoutBtn" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i>Sair
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black/50 modal-overlay flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="text-center mb-6">
                <i class="fas fa-clock text-4xl text-indigo-600 mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800">DeadlineX</h2>
                <p class="text-gray-600">Faça login para gerenciar seus prazos</p>
            </div>
            
            <div id="loginTabs" class="flex mb-6 bg-gray-100 rounded-lg p-1">
                <button id="loginTab" class="flex-1 py-2 px-4 rounded-md bg-white shadow-sm font-medium text-indigo-600">
                    Login
                </button>
                <button id="signupTab" class="flex-1 py-2 px-4 rounded-md font-medium text-gray-600">
                    Cadastro
                </button>
            </div>
            
            <form id="authForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="email" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                        <input type="password" id="password" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                </div>
                
                <button type="submit" id="authSubmit" 
                        class="w-full mt-6 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                    Entrar
                </button>
            </form>
            
            <div id="authError" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg hidden"></div>
        </div>
    </div>

    <!-- Main Content -->
    <main id="mainContent" class="container mx-auto px-4 py-8 hidden">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total</p>
                        <p id="totalDeadlines" class="text-2xl font-bold text-gray-900">0</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-calendar text-blue-600"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Urgentes</p>
                        <p id="urgentDeadlines" class="text-2xl font-bold text-red-600">0</p>
                    </div>
                    <div class="bg-red-100 p-3 rounded-full">
                        <i class="fas fa-exclamation-triangle text-red-600"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Concluídos</p>
                        <p id="completedDeadlines" class="text-2xl font-bold text-green-600">0</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-full">
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-6 shadow-sm card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Esta Semana</p>
                        <p id="weekDeadlines" class="text-2xl font-bold text-purple-600">0</p>
                    </div>
                    <div class="bg-purple-100 p-3 rounded-full">
                        <i class="fas fa-calendar-week text-purple-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Toggle -->
        <div class="flex justify-center mb-6">
            <div class="bg-white rounded-lg p-1 shadow-sm border">
                <button id="listViewBtn" class="px-6 py-2 rounded-md bg-indigo-600 text-white font-medium transition-colors">
                    <i class="fas fa-list mr-2"></i>Lista
                </button>
                <button id="calendarViewBtn" class="px-6 py-2 rounded-md text-gray-600 hover:text-indigo-600 font-medium transition-colors">
                    <i class="fas fa-calendar mr-2"></i>Calendário
                </button>
            </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 space-y-4 md:space-y-0">
            <div class="flex flex-wrap gap-3">
                <button id="addDeadlineBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    <i class="fas fa-plus mr-2"></i>Novo Prazo
                </button>
                
                <select id="categoryFilter" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    <option value="">Todas as Categorias</option>
                    <option value="saude">Saúde</option>
                    <option value="trabalho">Trabalho</option>
                    <option value="aniversarios">Aniversários</option>
                    <option value="outros">Outros</option>
                </select>
                
                <select id="priorityFilter" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    <option value="">Todas as Prioridades</option>
                    <option value="high">Alta</option>
                    <option value="normal">Normal</option>
                    <option value="low">Baixa</option>
                </select>
                
                <select id="statusFilter" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    <option value="">Todos os Status</option>
                    <option value="pending">Pendentes</option>
                    <option value="completed">Concluídos</option>
                    <option value="overdue">Em Atraso</option>
                </select>
            </div>
            
            <div class="flex items-center space-x-3">
                <input type="text" id="searchInput" placeholder="Buscar prazos..." 
                       class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 w-64">
                <button id="refreshBtn" class="bg-gray-100 hover:bg-gray-200 p-3 rounded-lg transition-colors">
                    <i class="fas fa-sync-alt text-gray-600"></i>
                </button>
            </div>
        </div>

        <!-- List View -->
        <div id="listView">
            <!-- Deadlines List -->
            <div id="deadlinesList" class="space-y-4">
                <!-- Deadlines will be loaded here -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="text-center py-12 hidden">
                <i class="fas fa-calendar-plus text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">Nenhum prazo encontrado</h3>
                <p class="text-gray-500 mb-6">Comece criando seu primeiro prazo!</p>
                <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                    <i class="fas fa-plus mr-2"></i>Criar Primeiro Prazo
                </button>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendarView" class="hidden">
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <!-- Calendar Header -->
                <div class="flex items-center justify-between p-6 border-b">
                    <h2 id="calendarMonth" class="text-xl font-semibold text-gray-800"></h2>
                    <div class="flex items-center space-x-2">
                        <button id="prevMonth" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                            <i class="fas fa-chevron-left text-gray-600"></i>
                        </button>
                        <button id="todayBtn" class="px-4 py-2 bg-indigo-100 text-indigo-600 rounded-lg hover:bg-indigo-200 transition-colors text-sm font-medium">
                            Hoje
                        </button>
                        <button id="nextMonth" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                            <i class="fas fa-chevron-right text-gray-600"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Calendar Grid -->
                <div class="p-6">
                    <!-- Days of Week -->
                    <div class="grid grid-cols-7 gap-1 mb-4">
                        <div class="text-center text-sm font-medium text-gray-500 py-2">Dom</div>
                        <div class="text-center text-sm font-medium text-gray-500 py-2">Seg</div>
                        <div class="text-center text-sm font-medium text-gray-500 py-2">Ter</div>
                        <div class="text-center text-sm font-medium text-gray-500 py-2">Qua</div>
                        <div class="text-center text-sm font-medium text-gray-500 py-2">Qui</div>
                        <div class="text-center text-sm font-medium text-gray-500 py-2">Sex</div>
                        <div class="text-center text-sm font-medium text-gray-500 py-2">Sáb</div>
                    </div>
                    
                    <!-- Calendar Days -->
                    <div id="calendarGrid" class="grid grid-cols-7 gap-1">
                        <!-- Calendar days will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add/Edit Deadline Modal -->
    <div id="deadlineModal" class="fixed inset-0 bg-black/50 modal-overlay flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Novo Prazo</h3>
                <button id="closeModal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="deadlineForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Título *</label>
                        <input type="text" id="deadlineTitle" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descrição</label>
                        <textarea id="deadlineDescription" rows="3" 
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data *</label>
                            <input type="date" id="deadlineDate" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria *</label>
                            <select id="deadlineCategory" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <option value="">Selecione</option>
                                <option value="saude">Saúde</option>
                                <option value="trabalho">Trabalho</option>
                                <option value="aniversarios">Aniversários</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Prioridade</label>
                            <select id="deadlinePriority" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <option value="normal">Normal</option>
                                <option value="high">Alta</option>
                                <option value="low">Baixa</option>
                            </select>
                        </div>
                        
                        <div class="flex items-center pt-8">
                            <input type="checkbox" id="deadlineNotification" checked 
                                   class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                            <label for="deadlineNotification" class="ml-2 text-sm text-gray-700">
                                Notificações
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-8">
                    <button type="button" id="cancelBtn" 
                            class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-3 px-4 rounded-lg transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="saveBtn" 
                            class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"></div>
            <span class="text-gray-700">Carregando...</span>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://vastjlzaxafpoagptklu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhc3RqbHpheGFmcG9hZ3B0a2x1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyNjUzMDEsImV4cCI6MjA3MTg0MTMwMX0.4EnnkdyVDEo1qSp1C2-QgVlklUkL2W3ulqOmXX_DiVY';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Global Variables
        let currentUser = null;
        let deadlines = [];
        let editingDeadline = null;
        let isSignupMode = false;
        let currentView = 'list';
        let currentDate = new Date();

        // DOM Elements
        const loginModal = document.getElementById('loginModal');
        const mainContent = document.getElementById('mainContent');
        const deadlineModal = document.getElementById('deadlineModal');
        const loadingOverlay = document.getElementById('loadingOverlay');
        
        // Initialize App
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuth();
            setupEventListeners();
        });

        // Authentication Functions
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            
            if (session) {
                currentUser = session.user;
                showMainContent();
                await loadDeadlines();
            } else {
                showLoginModal();
            }
        }

        function showLoginModal() {
            loginModal.classList.remove('hidden');
            mainContent.classList.add('hidden');
        }

        function showMainContent() {
            loginModal.classList.add('hidden');
            mainContent.classList.remove('hidden');
            document.getElementById('userEmail').textContent = currentUser.email;
        }

        function showLoading() {
            loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        // Event Listeners
        function setupEventListeners() {
            // Auth tabs
            document.getElementById('loginTab').addEventListener('click', () => switchAuthMode(false));
            document.getElementById('signupTab').addEventListener('click', () => switchAuthMode(true));
            
            // Auth form
            document.getElementById('authForm').addEventListener('submit', handleAuth);
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Add deadline
            document.getElementById('addDeadlineBtn').addEventListener('click', openAddModal);
            
            // Modal controls
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            
            // Deadline form
            document.getElementById('deadlineForm').addEventListener('submit', handleSaveDeadline);
            
            // View toggle
            document.getElementById('listViewBtn').addEventListener('click', () => switchView('list'));
            document.getElementById('calendarViewBtn').addEventListener('click', () => switchView('calendar'));
            
            // Calendar navigation
            document.getElementById('prevMonth').addEventListener('click', () => navigateMonth(-1));
            document.getElementById('nextMonth').addEventListener('click', () => navigateMonth(1));
            document.getElementById('todayBtn').addEventListener('click', goToToday);
            
            // Filters and search
            document.getElementById('categoryFilter').addEventListener('change', filterDeadlines);
            document.getElementById('priorityFilter').addEventListener('change', filterDeadlines);
            document.getElementById('statusFilter').addEventListener('change', filterDeadlines);
            document.getElementById('searchInput').addEventListener('input', filterDeadlines);
            
            // Refresh
            document.getElementById('refreshBtn').addEventListener('click', loadDeadlines);
        }

        function switchAuthMode(signup) {
            isSignupMode = signup;
            const loginTab = document.getElementById('loginTab');
            const signupTab = document.getElementById('signupTab');
            const submitBtn = document.getElementById('authSubmit');
            
            if (signup) {
                loginTab.classList.remove('bg-white', 'shadow-sm', 'text-indigo-600');
                loginTab.classList.add('text-gray-600');
                signupTab.classList.add('bg-white', 'shadow-sm', 'text-indigo-600');
                signupTab.classList.remove('text-gray-600');
                submitBtn.textContent = 'Cadastrar';
            } else {
                signupTab.classList.remove('bg-white', 'shadow-sm', 'text-indigo-600');
                signupTab.classList.add('text-gray-600');
                loginTab.classList.add('bg-white', 'shadow-sm', 'text-indigo-600');
                loginTab.classList.remove('text-gray-600');
                submitBtn.textContent = 'Entrar';
            }
        }

        async function handleAuth(e) {
            e.preventDefault();
            showLoading();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('authError');
            
            try {
                let result;
                if (isSignupMode) {
                    result = await supabase.auth.signUp({ email, password });
                } else {
                    result = await supabase.auth.signInWithPassword({ email, password });
                }
                
                if (result.error) {
                    throw result.error;
                }
                
                if (isSignupMode && !result.data.session) {
                    showError('Verifique seu email para confirmar o cadastro!', 'success');
                } else {
                    currentUser = result.data.user;
                    showMainContent();
                    await loadDeadlines();
                }
                
            } catch (error) {
                showError(getErrorMessage(error.message));
            } finally {
                hideLoading();
            }
        }

        async function handleLogout() {
            await supabase.auth.signOut();
            currentUser = null;
            deadlines = [];
            showLoginModal();
        }

        function showError(message, type = 'error') {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.className = `mt-4 p-3 border rounded-lg ${
                type === 'success' 
                    ? 'bg-green-100 border-green-400 text-green-700' 
                    : 'bg-red-100 border-red-400 text-red-700'
            }`;
            errorDiv.classList.remove('hidden');
            
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        function getErrorMessage(error) {
            const messages = {
                'Invalid login credentials': 'Email ou senha incorretos',
                'User already registered': 'Este email já está cadastrado',
                'Password should be at least 6 characters': 'A senha deve ter pelo menos 6 caracteres'
            };
            return messages[error] || 'Erro ao processar solicitação';
        }

        // Deadline Functions
        async function loadDeadlines() {
            if (!currentUser) return;
            
            showLoading();
            
            try {
                const { data, error } = await supabase
                    .from('deadlines')
                    .select('*')
                    .order('date', { ascending: true });
                
                if (error) throw error;
                
                deadlines = data || [];
                renderDeadlines();
                updateStats();
                
            } catch (error) {
                console.error('Erro ao carregar prazos:', error);
            } finally {
                hideLoading();
            }
        }

        function renderDeadlines() {
            if (currentView === 'list') {
                renderListView();
            } else {
                renderCalendarView();
            }
        }

        function renderListView() {
            const container = document.getElementById('deadlinesList');
            const emptyState = document.getElementById('emptyState');
            
            if (deadlines.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            const filteredDeadlines = getFilteredDeadlines();
            
            if (filteredDeadlines.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Nenhum prazo encontrado com os filtros aplicados</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredDeadlines.map(deadline => createDeadlineCard(deadline)).join('');
        }

        function renderCalendarView() {
            const calendarGrid = document.getElementById('calendarGrid');
            const monthElement = document.getElementById('calendarMonth');
            
            // Update month header
            const monthNames = [
                'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            monthElement.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Generate calendar days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const days = [];
            const today = new Date();
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const isCurrentMonth = date.getMonth() === currentDate.getMonth();
                const isToday = date.toDateString() === today.toDateString();
                const dateString = date.toISOString().split('T')[0];
                
                const dayDeadlines = getFilteredDeadlines().filter(d => d.date === dateString);
                
                days.push({
                    date: date,
                    day: date.getDate(),
                    isCurrentMonth,
                    isToday,
                    deadlines: dayDeadlines
                });
            }
            
            calendarGrid.innerHTML = days.map(day => createCalendarDay(day)).join('');
        }

        function getFilteredDeadlines() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            return deadlines.filter(deadline => {
                const matchesCategory = !categoryFilter || deadline.category === categoryFilter;
                const matchesPriority = !priorityFilter || deadline.priority === priorityFilter;
                const matchesSearch = !searchTerm || 
                    deadline.title.toLowerCase().includes(searchTerm) ||
                    (deadline.description && deadline.description.toLowerCase().includes(searchTerm));
                
                let matchesStatus = true;
                if (statusFilter) {
                    const daysUntil = getDaysUntilDeadline(deadline.date);
                    switch (statusFilter) {
                        case 'pending':
                            matchesStatus = !deadline.completed;
                            break;
                        case 'completed':
                            matchesStatus = deadline.completed;
                            break;
                        case 'overdue':
                            matchesStatus = !deadline.completed && daysUntil < 0;
                            break;
                    }
                }
                
                return matchesCategory && matchesPriority && matchesSearch && matchesStatus;
            });
        }

        function createDeadlineCard(deadline) {
            const daysUntil = getDaysUntilDeadline(deadline.date);
            const isUrgent = daysUntil <= 7 && daysUntil >= 0;
            const isOverdue = daysUntil < 0;
            
            const priorityClass = `priority-${deadline.priority}`;
            const categoryClass = `category-${deadline.category}`;
            const urgentClass = isUrgent ? 'deadline-urgent' : '';
            
            return `
                <div class="bg-white rounded-xl p-6 shadow-sm card-hover ${priorityClass} ${urgentClass}">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <h3 class="text-lg font-semibold text-gray-800 ${deadline.completed ? 'line-through opacity-60' : ''}">
                                    ${deadline.title}
                                </h3>
                                <span class="px-2 py-1 text-xs font-medium text-white rounded-full ${categoryClass}">
                                    ${getCategoryLabel(deadline.category)}
                                </span>
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${getPriorityBadge(deadline.priority)}">
                                    ${getPriorityLabel(deadline.priority)}
                                </span>
                            </div>
                            
                            ${deadline.description ? `
                                <p class="text-gray-600 text-sm mb-3 ${deadline.completed ? 'opacity-60' : ''}">
                                    ${deadline.description}
                                </p>
                            ` : ''}
                            
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <div class="flex items-center space-x-1">
                                    <i class="fas fa-calendar"></i>
                                    <span>${formatDate(deadline.date)}</span>
                                </div>
                                
                                <div class="flex items-center space-x-1">
                                    <i class="fas fa-clock"></i>
                                    <span class="${isOverdue ? 'text-red-600 font-medium' : isUrgent ? 'text-orange-600 font-medium' : ''}">
                                        ${getTimeUntilText(daysUntil)}
                                    </span>
                                </div>
                                
                                ${deadline.notification ? '<i class="fas fa-bell text-blue-500" title="Notificações ativas"></i>' : ''}
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-2 ml-4">
                            <button onclick="toggleComplete(${deadline.id})" 
                                    class="p-2 rounded-lg transition-colors ${
                                        deadline.completed 
                                            ? 'bg-green-100 text-green-600 hover:bg-green-200' 
                                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                    }" 
                                    title="${deadline.completed ? 'Marcar como pendente' : 'Marcar como concluído'}">
                                <i class="fas ${deadline.completed ? 'fa-check-circle' : 'fa-circle'}"></i>
                            </button>
                            
                            <button onclick="editDeadline(${deadline.id})" 
                                    class="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors"
                                    title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            
                            <button onclick="deleteDeadline(${deadline.id})" 
                                    class="p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors"
                                    title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Utility Functions
        function getDaysUntilDeadline(dateString) {
            const today = new Date();
            const deadline = new Date(dateString);
            const diffTime = deadline - today;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function getTimeUntilText(days) {
            if (days < 0) return `${Math.abs(days)} dias em atraso`;
            if (days === 0) return 'Hoje';
            if (days === 1) return 'Amanhã';
            if (days <= 7) return `${days} dias`;
            if (days <= 30) return `${Math.ceil(days / 7)} semanas`;
            return `${Math.ceil(days / 30)} meses`;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('pt-BR');
        }

        function getCategoryLabel(category) {
            const labels = {
                'saude': 'Saúde',
                'trabalho': 'Trabalho',
                'aniversarios': 'Aniversários',
                'outros': 'Outros'
            };
            return labels[category] || category;
        }

        function getPriorityLabel(priority) {
            const labels = {
                'high': 'Alta',
                'normal': 'Normal',
                'low': 'Baixa'
            };
            return labels[priority] || priority;
        }

        function getPriorityBadge(priority) {
            const badges = {
                'high': 'bg-red-100 text-red-800',
                'normal': 'bg-blue-100 text-blue-800',
                'low': 'bg-green-100 text-green-800'
            };
            return badges[priority] || badges.normal;
        }

        function updateStats() {
            const total = deadlines.length;
            const completed = deadlines.filter(d => d.completed).length;
            const urgent = deadlines.filter(d => {
                const days = getDaysUntilDeadline(d.date);
                return days <= 7 && days >= 0 && !d.completed;
            }).length;
            
            const weekStart = new Date();
            const weekEnd = new Date();
            weekEnd.setDate(weekEnd.getDate() + 7);
            
            const thisWeek = deadlines.filter(d => {
                const deadlineDate = new Date(d.date);
                return deadlineDate >= weekStart && deadlineDate <= weekEnd && !d.completed;
            }).length;
            
            document.getElementById('totalDeadlines').textContent = total;
            document.getElementById('completedDeadlines').textContent = completed;
            document.getElementById('urgentDeadlines').textContent = urgent;
            document.getElementById('weekDeadlines').textContent = thisWeek;
        }

        // Modal Functions
        function openAddModal() {
            editingDeadline = null;
            document.getElementById('modalTitle').textContent = 'Novo Prazo';
            document.getElementById('deadlineForm').reset();
            document.getElementById('deadlinePriority').value = 'normal';
            document.getElementById('deadlineNotification').checked = true;
            deadlineModal.classList.remove('hidden');
        }

        function editDeadline(id) {
            const deadline = deadlines.find(d => d.id === id);
            if (!deadline) return;
            
            editingDeadline = deadline;
            document.getElementById('modalTitle').textContent = 'Editar Prazo';
            
            document.getElementById('deadlineTitle').value = deadline.title;
            document.getElementById('deadlineDescription').value = deadline.description || '';
            document.getElementById('deadlineDate').value = deadline.date;
            document.getElementById('deadlineCategory').value = deadline.category;
            document.getElementById('deadlinePriority').value = deadline.priority;
            document.getElementById('deadlineNotification').checked = deadline.notification;
            
            deadlineModal.classList.remove('hidden');
        }

        function closeModal() {
            deadlineModal.classList.add('hidden');
            editingDeadline = null;
        }

        async function handleSaveDeadline(e) {
            e.preventDefault();
            showLoading();
            
            const formData = {
                title: document.getElementById('deadlineTitle').value,
                description: document.getElementById('deadlineDescription').value || null,
                date: document.getElementById('deadlineDate').value,
                category: document.getElementById('deadlineCategory').value,
                priority: document.getElementById('deadlinePriority').value,
                notification: document.getElementById('deadlineNotification').checked,
                user_id: currentUser.id
            };
            
            try {
                let result;
                if (editingDeadline) {
                    result = await supabase
                        .from('deadlines')
                        .update(formData)
                        .eq('id', editingDeadline.id);
                } else {
                    result = await supabase
                        .from('deadlines')
                        .insert([formData]);
                }
                
                if (result.error) throw result.error;
                
                closeModal();
                await loadDeadlines();
                
            } catch (error) {
                console.error('Erro ao salvar prazo:', error);
                alert('Erro ao salvar prazo. Tente novamente.');
            } finally {
                hideLoading();
            }
        }

        async function toggleComplete(id) {
            const deadline = deadlines.find(d => d.id === id);
            if (!deadline) return;
            
            showLoading();
            
            try {
                const { error } = await supabase
                    .from('deadlines')
                    .update({ completed: !deadline.completed })
                    .eq('id', id);
                
                if (error) throw error;
                
                await loadDeadlines();
                
            } catch (error) {
                console.error('Erro ao atualizar prazo:', error);
            } finally {
                hideLoading();
            }
        }

        async function deleteDeadline(id) {
            if (!confirm('Tem certeza que deseja excluir este prazo?')) return;
            
            showLoading();
            
            try {
                const { error } = await supabase
                    .from('deadlines')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                await loadDeadlines();
                
            } catch (error) {
                console.error('Erro ao excluir prazo:', error);
            } finally {
                hideLoading();
            }
        }

        function createCalendarDay(day) {
            const dayClasses = [
                'calendar-day',
                'p-2',
                'cursor-pointer'
            ];
            
            if (!day.isCurrentMonth) dayClasses.push('other-month');
            if (day.isToday) dayClasses.push('today');
            
            const eventsHtml = day.deadlines.slice(0, 3).map(deadline => {
                const priorityClass = deadline.priority;
                const completedClass = deadline.completed ? 'completed' : '';
                return `
                    <div class="calendar-event ${priorityClass} ${completedClass}" 
                         onclick="editDeadline(${deadline.id})" 
                         title="${deadline.title}${deadline.description ? ' - ' + deadline.description : ''}">
                        ${deadline.title.length > 15 ? deadline.title.substring(0, 15) + '...' : deadline.title}
                    </div>
                `;
            }).join('');
            
            const moreEvents = day.deadlines.length > 3 ? 
                `<div class="text-xs text-gray-500 mt-1">+${day.deadlines.length - 3} mais</div>` : '';
            
            return `
                <div class="${dayClasses.join(' ')}" onclick="selectCalendarDate('${day.date.toISOString().split('T')[0]}')">
                    <div class="font-medium text-sm mb-1">${day.day}</div>
                    ${eventsHtml}
                    ${moreEvents}
                </div>
            `;
        }

        function switchView(view) {
            currentView = view;
            
            const listViewBtn = document.getElementById('listViewBtn');
            const calendarViewBtn = document.getElementById('calendarViewBtn');
            const listView = document.getElementById('listView');
            const calendarView = document.getElementById('calendarView');
            
            if (view === 'list') {
                listViewBtn.classList.add('bg-indigo-600', 'text-white');
                listViewBtn.classList.remove('text-gray-600');
                calendarViewBtn.classList.remove('bg-indigo-600', 'text-white');
                calendarViewBtn.classList.add('text-gray-600');
                
                listView.classList.remove('hidden');
                calendarView.classList.add('hidden');
            } else {
                calendarViewBtn.classList.add('bg-indigo-600', 'text-white');
                calendarViewBtn.classList.remove('text-gray-600');
                listViewBtn.classList.remove('bg-indigo-600', 'text-white');
                listViewBtn.classList.add('text-gray-600');
                
                listView.classList.add('hidden');
                calendarView.classList.remove('hidden');
            }
            
            renderDeadlines();
        }

        function navigateMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendarView();
        }

        function goToToday() {
            currentDate = new Date();
            renderCalendarView();
        }

        function selectCalendarDate(dateString) {
            // Open modal with pre-filled date
            openAddModal();
            document.getElementById('deadlineDate').value = dateString;
        }

        function filterDeadlines() {
            renderDeadlines();
        }

        // Listen for auth changes
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN') {
                currentUser = session.user;
                showMainContent();
                loadDeadlines();
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                deadlines = [];
                showLoginModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9803fb02d32ea188',t:'MTc1ODA2MzYzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
































