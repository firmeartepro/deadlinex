<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeadlineX - Sistema de Gest√£o de Prazos</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .task-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .task-card.urgent { border-left-color: #ef4444; }
        .task-card.warning { border-left-color: #f59e0b; }
        .task-card.normal { border-left-color: #10b981; }
        
        .priority-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
        }
        
        .priority-urgent { background: #fef2f2; color: #dc2626; }
        .priority-high { background: #fef3c7; color: #d97706; }
        .priority-medium { background: #ecfdf5; color: #059669; }
        .priority-low { background: #f0f9ff; color: #0284c7; }
        
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
        }
        
        .status-pending { background: #fef3c7; color: #d97706; }
        .status-progress { background: #dbeafe; color: #2563eb; }
        .status-completed { background: #ecfdf5; color: #059669; }
        .status-overdue { background: #fef2f2; color: #dc2626; }
        
        .category-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
            background: #f3f4f6;
            color: #374151;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .notification.warning { background: #f59e0b; }
        
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .sidebar-transition {
            transition: transform 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .sidebar-hidden {
                transform: translateX(-100%);
            }
        }

        .premium-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #92400e;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
        }

        .premium-feature {
            position: relative;
        }

        .premium-feature::after {
            content: 'üëë';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 12px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Notification Container -->
    <div id="notification" class="notification"></div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-clock text-2xl text-indigo-600"></i>
                </div>
                <h1 class="text-2xl font-bold text-white mb-2">DeadlineX</h1>
                <p class="text-indigo-100">Sistema de Gest√£o de Prazos</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Email</label>
                    <input type="email" id="loginEmail" required 
                           class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50"
                           placeholder="seu@email.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Senha</label>
                    <input type="password" id="loginPassword" required 
                           class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50"
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <button type="submit" 
                        class="w-full bg-white text-indigo-600 py-3 rounded-lg font-semibold hover:bg-gray-100 transition duration-200">
                    Entrar
                </button>
            </form>
            
            <div class="mt-6 text-center space-y-2">
                <button id="showRegister" class="text-white/80 hover:text-white text-sm block w-full">
                    N√£o tem conta? Cadastre-se
                </button>
                <button id="showForgotPassword" class="text-white/80 hover:text-white text-sm">
                    Esqueceu a senha?
                </button>
            </div>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4 hidden">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-plus text-2xl text-indigo-600"></i>
                </div>
                <h1 class="text-2xl font-bold text-white mb-2">Criar Conta</h1>
                <p class="text-indigo-100">Cadastre-se no DeadlineX</p>
            </div>
            
            <form id="registerForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Nome Completo</label>
                    <input type="text" id="registerName" required 
                           class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50"
                           placeholder="Seu nome completo">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Email</label>
                    <input type="email" id="registerEmail" required 
                           class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50"
                           placeholder="seu@email.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Senha</label>
                    <input type="password" id="registerPassword" required 
                           class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50"
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="acceptTerms" required class="mr-2">
                    <label for="acceptTerms" class="text-sm text-white">
                        Aceito os <button type="button" id="showTerms" class="underline">Termos de Uso</button> e 
                        <button type="button" id="showPrivacy" class="underline">Pol√≠tica de Privacidade</button>
                    </label>
                </div>
                
                <button type="submit" 
                        class="w-full bg-white text-indigo-600 py-3 rounded-lg font-semibold hover:bg-gray-100 transition duration-200">
                    Criar Conta
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <button id="showLogin" class="text-white/80 hover:text-white text-sm">
                    J√° tem conta? Fa√ßa login
                </button>
            </div>
        </div>
    </div>

    <!-- Forgot Password Screen -->
    <div id="forgotPasswordScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4 hidden">
        <div class="glass-effect rounded-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-key text-2xl text-indigo-600"></i>
                </div>
                <h1 class="text-2xl font-bold text-white mb-2">Recuperar Senha</h1>
                <p class="text-indigo-100">Digite seu email para receber as instru√ß√µes</p>
            </div>
            
            <form id="forgotPasswordForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Email</label>
                    <input type="email" id="forgotEmail" required 
                           class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50"
                           placeholder="seu@email.com">
                </div>
                
                <button type="submit" 
                        class="w-full bg-white text-indigo-600 py-3 rounded-lg font-semibold hover:bg-gray-100 transition duration-200">
                    Enviar Instru√ß√µes
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <button id="backToLogin" class="text-white/80 hover:text-white text-sm">
                    Voltar ao login
                </button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden min-h-screen bg-gray-50">
        <!-- Sidebar -->
        <div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg sidebar-transition">
            <div class="flex items-center justify-between h-16 px-6 border-b">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-clock text-white text-sm"></i>
                    </div>
                    <span class="ml-3 text-xl font-semibold text-gray-800">DeadlineX</span>
                </div>
                <button id="closeSidebar" class="md:hidden text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <nav class="mt-6">
                <div class="px-6 mb-4">
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Menu</p>
                </div>
                
                <a href="#" id="dashboardTab" class="nav-item active flex items-center px-6 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                    <i class="fas fa-home w-5"></i>
                    <span class="ml-3">Dashboard</span>
                </a>
                
                <a href="#" id="tasksTab" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                    <i class="fas fa-tasks w-5"></i>
                    <span class="ml-3">Tarefas</span>
                </a>

                <a href="#" id="categoriesTab" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                    <i class="fas fa-folder w-5"></i>
                    <span class="ml-3">Categorias</span>
                </a>
                
                <a href="#" id="calendarTab" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                    <i class="fas fa-calendar w-5"></i>
                    <span class="ml-3">Calend√°rio</span>
                </a>
                
                <a href="#" id="reportsTab" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                    <i class="fas fa-chart-bar w-5"></i>
                    <span class="ml-3">Relat√≥rios</span>
                </a>

                <a href="#" id="premiumTab" class="nav-item premium-feature flex items-center px-6 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                    <i class="fas fa-crown w-5"></i>
                    <span class="ml-3">Premium</span>
                </a>

                <a href="#" id="settingsTab" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                    <i class="fas fa-cog w-5"></i>
                    <span class="ml-3">Configura√ß√µes</span>
                </a>
            </nav>
            
            <div class="absolute bottom-0 w-full p-6 border-t">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-gray-600 text-sm"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-700" id="userName">Usu√°rio</p>
                        <div class="flex items-center space-x-2">
                            <span id="userPlan" class="text-xs text-gray-500">Plano Gratuito</span>
                            <button id="logoutBtn" class="text-xs text-gray-500 hover:text-gray-700">Sair</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="md:ml-64">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b">
                <div class="flex items-center justify-between h-16 px-6">
                    <div class="flex items-center">
                        <button id="openSidebar" class="md:hidden text-gray-500 hover:text-gray-700 mr-4">
                            <i class="fas fa-bars"></i>
                        </button>
                        <h1 id="pageTitle" class="text-xl font-semibold text-gray-800">Dashboard</h1>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button id="addTaskBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Nova Tarefa
                        </button>
                    </div>
                </div>
            </header>

            <!-- Dashboard Content -->
            <div id="dashboardContent" class="p-6">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 shadow-sm border">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-tasks text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total de Tarefas</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalTasks">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-sm border">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-clock text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Pendentes</p>
                                <p class="text-2xl font-bold text-gray-900" id="pendingTasks">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-sm border">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Conclu√≠das</p>
                                <p class="text-2xl font-bold text-gray-900" id="completedTasks">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-sm border">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Atrasadas</p>
                                <p class="text-2xl font-bold text-gray-900" id="overdueTasks">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Tasks -->
                <div class="bg-white rounded-xl shadow-sm border">
                    <div class="p-6 border-b">
                        <h2 class="text-lg font-semibold text-gray-800">Tarefas Recentes</h2>
                    </div>
                    <div class="p-6">
                        <div id="recentTasksList" class="space-y-4">
                            <!-- Tasks will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks Content -->
            <div id="tasksContent" class="p-6 hidden">
                <!-- Filters -->
                <div class="bg-white rounded-xl p-6 shadow-sm border mb-6">
                    <div class="flex flex-wrap gap-4">
                        <select id="statusFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">Todos os Status</option>
                            <option value="pending">Pendente</option>
                            <option value="in_progress">Em Andamento</option>
                            <option value="completed">Conclu√≠da</option>
                            <option value="overdue">Atrasada</option>
                        </select>
                        
                        <select id="priorityFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">Todas as Prioridades</option>
                            <option value="urgent">Urgente</option>
                            <option value="high">Alta</option>
                            <option value="medium">M√©dia</option>
                            <option value="low">Baixa</option>
                        </select>

                        <select id="categoryFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">Todas as Categorias</option>
                        </select>
                        
                        <input type="text" id="searchTasks" placeholder="Buscar tarefas..." 
                               class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 flex-1 min-w-0">
                    </div>
                </div>

                <!-- Tasks List -->
                <div class="bg-white rounded-xl shadow-sm border">
                    <div class="p-6 border-b">
                        <h2 class="text-lg font-semibold text-gray-800">Todas as Tarefas</h2>
                    </div>
                    <div class="p-6">
                        <div id="tasksList" class="space-y-4">
                            <!-- Tasks will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Categories Content -->
            <div id="categoriesContent" class="p-6 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Categorias</h2>
                    <button id="addCategoryBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Nova Categoria
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div id="categoriesList">
                        <!-- Categories will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Calendar Content -->
            <div id="calendarContent" class="p-6 hidden">
                <div class="bg-white rounded-xl shadow-sm border p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">Calend√°rio de Tarefas</h2>
                    <div id="calendar" class="text-center text-gray-500">
                        Calend√°rio em desenvolvimento...
                    </div>
                </div>
            </div>

            <!-- Reports Content -->
            <div id="reportsContent" class="p-6 hidden">
                <div class="bg-white rounded-xl shadow-sm border p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">Relat√≥rios</h2>
                    <div id="reports" class="text-center text-gray-500">
                        Relat√≥rios em desenvolvimento...
                    </div>
                </div>
            </div>

            <!-- Premium Content -->
            <div id="premiumContent" class="p-6 hidden">
                <div class="max-w-4xl mx-auto">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-crown text-yellow-500 mr-2"></i>
                            DeadlineX Premium
                        </h1>
                        <p class="text-gray-600">Desbloqueie todo o potencial do seu gerenciamento de tarefas</p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8 mb-8">
                        <!-- Plano Gratuito -->
                        <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                            <h3 class="text-xl font-semibold mb-4">Plano Gratuito</h3>
                            <div class="text-3xl font-bold mb-4">R$ 0<span class="text-sm text-gray-500">/m√™s</span></div>
                            <ul class="space-y-3 mb-6">
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>At√© 50 tarefas</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>3 categorias</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Relat√≥rios b√°sicos</li>
                                <li class="flex items-center"><i class="fas fa-times text-red-500 mr-2"></i>Sem notifica√ß√µes</li>
                                <li class="flex items-center"><i class="fas fa-times text-red-500 mr-2"></i>Sem backup autom√°tico</li>
                            </ul>
                            <button class="w-full py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50" disabled>
                                Plano Atual
                            </button>
                        </div>

                        <!-- Plano Premium -->
                        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-6 border-2 border-yellow-300 relative">
                            <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                                <span class="premium-badge">MAIS POPULAR</span>
                            </div>
                            <h3 class="text-xl font-semibold mb-4">Plano Premium</h3>
                            <div class="text-3xl font-bold mb-4">R$ 19,90<span class="text-sm text-gray-500">/m√™s</span></div>
                            <ul class="space-y-3 mb-6">
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Tarefas ilimitadas</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Categorias ilimitadas</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Relat√≥rios avan√ßados</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Notifica√ß√µes por email/WhatsApp</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Backup autom√°tico</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Suporte priorit√°rio</li>
                                <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Temas personalizados</li>
                            </ul>
                            <button id="upgradeToPremium" class="w-full py-2 px-4 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 font-semibold">
                                Assinar Premium
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 border">
                        <h3 class="text-lg font-semibold mb-4">Perguntas Frequentes</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-medium text-gray-800">Posso cancelar a qualquer momento?</h4>
                                <p class="text-gray-600 text-sm">Sim, voc√™ pode cancelar sua assinatura a qualquer momento sem taxas adicionais.</p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">O que acontece com meus dados se eu cancelar?</h4>
                                <p class="text-gray-600 text-sm">Seus dados ficam salvos por 30 dias ap√≥s o cancelamento. Voc√™ pode reativar a qualquer momento.</p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">H√° desconto para pagamento anual?</h4>
                                <p class="text-gray-600 text-sm">Sim! Pagando anualmente voc√™ economiza 20% (R$ 191,04/ano).</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Content -->
            <div id="settingsContent" class="p-6 hidden">
                <div class="max-w-2xl mx-auto space-y-6">
                    <h2 class="text-2xl font-bold text-gray-800">Configura√ß√µes</h2>

                    <!-- Profile Settings -->
                    <div class="bg-white rounded-xl p-6 shadow-sm border">
                        <h3 class="text-lg font-semibold mb-4">Perfil</h3>
                        <form id="profileForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                                <input type="text" id="profileName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" id="profileEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" disabled>
                            </div>
                            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                                Salvar Altera√ß√µes
                            </button>
                        </form>
                    </div>

                    <!-- Notification Settings -->
                    <div class="bg-white rounded-xl p-6 shadow-sm border">
                        <h3 class="text-lg font-semibold mb-4">Notifica√ß√µes</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">Email</h4>
                                    <p class="text-sm text-gray-600">Receber notifica√ß√µes por email</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="emailNotifications" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium">WhatsApp <span class="premium-badge">Premium</span></h4>
                                    <p class="text-sm text-gray-600">Receber notifica√ß√µes via WhatsApp</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="whatsappNotifications" class="sr-only peer" disabled>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Security Settings -->
                    <div class="bg-white rounded-xl p-6 shadow-sm border">
                        <h3 class="text-lg font-semibold mb-4">Seguran√ßa</h3>
                        <div class="space-y-4">
                            <button id="changePasswordBtn" class="w-full text-left p-3 border border-gray-300 rounded-lg hover:bg-gray-50">
                                <i class="fas fa-key mr-2"></i>Alterar Senha
                            </button>
                            <button id="exportDataBtn" class="w-full text-left p-3 border border-gray-300 rounded-lg hover:bg-gray-50">
                                <i class="fas fa-download mr-2"></i>Exportar Dados
                            </button>
                        </div>
                    </div>

                    <!-- Danger Zone -->
                    <div class="bg-red-50 rounded-xl p-6 border border-red-200">
                        <h3 class="text-lg font-semibold text-red-800 mb-4">Zona de Perigo</h3>
                        <p class="text-red-600 text-sm mb-4">
                            Estas a√ß√µes s√£o irrevers√≠veis. Tenha certeza antes de prosseguir.
                        </p>
                        <button id="deleteAccountBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                            Excluir Conta Permanentemente
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" id="modalOverlay"></div>
        <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-md">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-800" id="modalTitle">Nova Tarefa</h3>
                </div>
                
                <form id="taskForm" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√≠tulo</label>
                        <input type="text" id="taskTitle" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                        <textarea id="taskDescription" rows="3" 
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Prioridade</label>
                            <select id="taskPriority" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="low">Baixa</option>
                                <option value="medium" selected>M√©dia</option>
                                <option value="high">Alta</option>
                                <option value="urgent">Urgente</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="taskStatus" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="pending" selected>Pendente</option>
                                <option value="in_progress">Em Andamento</option>
                                <option value="completed">Conclu√≠da</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                        <select id="taskCategory" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">Sem categoria</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data de Vencimento</label>
                        <input type="datetime-local" id="taskDueDate" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancelTask" 
                                class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" 
                                class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" id="categoryModalOverlay"></div>
        <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-md">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-800" id="categoryModalTitle">Nova Categoria</h3>
                </div>
                
                <form id="categoryForm" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome</label>
                        <input type="text" id="categoryName" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                        <textarea id="categoryDescription" rows="3" 
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cor</label>
                        <div class="flex space-x-2">
                            <input type="color" id="categoryColor" value="#3b82f6" 
                                   class="w-12 h-10 border border-gray-300 rounded-lg">
                            <input type="text" id="categoryColorText" value="#3b82f6" 
                                   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancelCategory" 
                                class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" 
                                class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Terms Modal -->
    <div id="termsModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" id="termsModalOverlay"></div>
        <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[80vh] overflow-y-auto">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-800">Termos de Uso</h3>
                </div>
                <div class="p-6">
                    <div class="prose max-w-none">
                        <h4>1. Aceita√ß√£o dos Termos</h4>
                        <p>Ao usar o DeadlineX, voc√™ concorda com estes termos de uso.</p>
                        
                        <h4>2. Uso do Servi√ßo</h4>
                        <p>O DeadlineX √© um sistema de gerenciamento de tarefas e prazos. Voc√™ pode usar o servi√ßo para organizar suas atividades pessoais e profissionais.</p>
                        
                        <h4>3. Conta do Usu√°rio</h4>
                        <p>Voc√™ √© respons√°vel por manter a seguran√ßa de sua conta e senha.</p>
                        
                        <h4>4. Privacidade</h4>
                        <p>Respeitamos sua privacidade conforme descrito em nossa Pol√≠tica de Privacidade.</p>
                        
                        <h4>5. Limita√ß√µes</h4>
                        <p>O servi√ßo √© fornecido "como est√°" sem garantias de qualquer tipo.</p>
                    </div>
                </div>
                <div class="p-6 border-t">
                    <button id="closeTerms" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Modal -->
    <div id="privacyModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" id="privacyModalOverlay"></div>
        <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[80vh] overflow-y-auto">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-800">Pol√≠tica de Privacidade</h3>
                </div>
                <div class="p-6">
                    <div class="prose max-w-none">
                        <h4>1. Informa√ß√µes Coletadas</h4>
                        <p>Coletamos apenas as informa√ß√µes necess√°rias para o funcionamento do servi√ßo: email, nome e dados das tarefas.</p>
                        
                        <h4>2. Uso das Informa√ß√µes</h4>
                        <p>Suas informa√ß√µes s√£o usadas exclusivamente para fornecer o servi√ßo de gerenciamento de tarefas.</p>
                        
                        <h4>3. Compartilhamento</h4>
                        <p>N√£o compartilhamos suas informa√ß√µes pessoais com terceiros.</p>
                        
                        <h4>4. Seguran√ßa</h4>
                        <p>Implementamos medidas de seguran√ßa para proteger suas informa√ß√µes.</p>
                        
                        <h4>5. Seus Direitos</h4>
                        <p>Voc√™ pode acessar, corrigir ou excluir suas informa√ß√µes a qualquer momento.</p>
                    </div>
                </div>
                <div class="p-6 border-t">
                    <button id="closePrivacy" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://vastjlzaxafpoagptklu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhc3RqbHpheGFmcG9hZ3B0a2x1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyNjUzMDEsImV4cCI6MjA3MTg0MTMwMX0.4EnnkdyVDEo1qSp1C2-QgVlklUkL2W3ulqOmXX_DiVY';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Global variables
        let currentUser = null;
        let tasks = [];
        let categories = [];
        let editingTaskId = null;
        let editingCategoryId = null;
        let userPlan = 'free'; // free or premium

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const registerScreen = document.getElementById('registerScreen');
        const forgotPasswordScreen = document.getElementById('forgotPasswordScreen');
        const dashboard = document.getElementById('dashboard');
        const sidebar = document.getElementById('sidebar');
        const taskModal = document.getElementById('taskModal');
        const categoryModal = document.getElementById('categoryModal');
        const termsModal = document.getElementById('termsModal');
        const privacyModal = document.getElementById('privacyModal');

        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('App initializing...');
            console.log('Supabase URL:', SUPABASE_URL);
            console.log('Supabase client:', supabase);
            
            // Test connection
            try {
                const { data, error } = await supabase.from('profiles').select('count').limit(1);
                console.log('Supabase connection test:', { data, error });
            } catch (err) {
                console.error('Supabase connection error:', err);
            }
            
            await checkAuth();
            setupEventListeners();
        });

        // Authentication functions
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                console.log('User authenticated:', currentUser.id);
                await loadUserProfile();
                showDashboard();
                await loadCategories();
                await loadTasks();
            } else {
                showLogin();
            }
        }

        async function loadUserProfile() {
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (error && error.code !== 'PGRST116') {
                    console.error('Error loading profile:', error);
                    throw error;
                }

                if (data) {
                    userPlan = data.plan || 'free';
                    updateUserPlanDisplay();
                    console.log('Profile loaded:', data);
                } else {
                    console.log('Profile not found, creating default...');
                    await createUserProfile();
                }
            } catch (error) {
                console.error('Error in loadUserProfile:', error);
                // Continue anyway with default values
                userPlan = 'free';
                updateUserPlanDisplay();
            }
        }

        async function createUserProfile() {
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .insert([{
                        id: currentUser.id,
                        email: currentUser.email,
                        full_name: currentUser.user_metadata?.full_name || '',
                        plan: 'free',
                        created_at: new Date().toISOString()
                    }])
                    .select()
                    .single();

                if (error) {
                    console.error('Error creating profile:', error);
                    throw error;
                }

                console.log('Profile created:', data);
                userPlan = 'free';
                updateUserPlanDisplay();
            } catch (error) {
                console.error('Error creating profile:', error);
                // Continue anyway
                userPlan = 'free';
                updateUserPlanDisplay();
            }
        }

        function updateUserPlanDisplay() {
            const planElement = document.getElementById('userPlan');
            if (userPlan === 'premium') {
                planElement.innerHTML = '<span class="premium-badge">Premium</span>';
            } else {
                planElement.textContent = 'Plano Gratuito';
            }
        }

        async function login(email, password) {
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                currentUser = data.user;
                showNotification('Login realizado com sucesso!', 'success');
                await loadUserProfile();
                showDashboard();
                await loadCategories();
                await loadTasks();
            } catch (error) {
                showNotification('Erro no login: ' + error.message, 'error');
            }
        }

        async function register(email, password, name) {
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: name
                        }
                    }
                });

                if (error) throw error;

                showNotification('Conta criada com sucesso! Verifique seu email.', 'success');
                showLogin();
            } catch (error) {
                showNotification('Erro no cadastro: ' + error.message, 'error');
            }
        }

        async function forgotPassword(email) {
            try {
                const { error } = await supabase.auth.resetPasswordForEmail(email);
                if (error) throw error;

                showNotification('Instru√ß√µes enviadas para seu email!', 'success');
                showLogin();
            } catch (error) {
                showNotification('Erro: ' + error.message, 'error');
            }
        }

        async function logout() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;

                currentUser = null;
                tasks = [];
                categories = [];
                userPlan = 'free';
                showLogin();
                showNotification('Logout realizado com sucesso!', 'success');
            } catch (error) {
                showNotification('Erro no logout: ' + error.message, 'error');
            }
        }

        // Task functions
        async function loadTasks() {
            try {
                console.log('Loading tasks for user:', currentUser.id);
                const { data, error } = await supabase
                    .from('tasks')
                    .select(`
                        *,
                        categories (
                            id,
                            name,
                            color
                        )
                    `)
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Error loading tasks:', error);
                    throw error;
                }

                console.log('Tasks loaded:', data);
                tasks = data || [];
                updateTasksDisplay();
                updateStats();
            } catch (error) {
                console.error('Error in loadTasks:', error);
                showNotification('Erro ao carregar tarefas: ' + error.message, 'error');
                tasks = [];
                updateTasksDisplay();
                updateStats();
            }
        }

        async function saveTask(taskData) {
            try {
                // Check limits for free users
                if (userPlan === 'free' && !editingTaskId && tasks.length >= 50) {
                    showNotification('Limite de 50 tarefas atingido. Fa√ßa upgrade para Premium!', 'warning');
                    return;
                }

                const taskPayload = {
                    ...taskData,
                    user_id: currentUser.id,
                    created_at: editingTaskId ? undefined : new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };

                if (editingTaskId) {
                    const { data, error } = await supabase
                        .from('tasks')
                        .update(taskPayload)
                        .eq('id', editingTaskId)
                        .eq('user_id', currentUser.id)
                        .select()
                        .single();

                    if (error) throw error;
                    console.log('Task updated:', data);
                    showNotification('Tarefa atualizada com sucesso!', 'success');
                } else {
                    const { data, error } = await supabase
                        .from('tasks')
                        .insert([taskPayload])
                        .select()
                        .single();

                    if (error) throw error;
                    console.log('Task created:', data);
                    showNotification('Tarefa criada com sucesso!', 'success');
                }

                await loadTasks();
                closeTaskModal();
            } catch (error) {
                console.error('Error saving task:', error);
                showNotification('Erro ao salvar tarefa: ' + error.message, 'error');
            }
        }

        async function deleteTask(taskId) {
            if (!confirm('Tem certeza que deseja excluir esta tarefa?')) return;

            try {
                const { error } = await supabase
                    .from('tasks')
                    .delete()
                    .eq('id', taskId);

                if (error) throw error;

                showNotification('Tarefa exclu√≠da com sucesso!', 'success');
                await loadTasks();
            } catch (error) {
                showNotification('Erro ao excluir tarefa: ' + error.message, 'error');
            }
        }

        // Category functions
        async function loadCategories() {
            try {
                console.log('Loading categories for user:', currentUser.id);
                const { data, error } = await supabase
                    .from('categories')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('name');

                if (error) {
                    console.error('Error loading categories:', error);
                    throw error;
                }

                console.log('Categories loaded:', data);
                categories = data || [];
                updateCategoriesDisplay();
                updateCategorySelects();
            } catch (error) {
                console.error('Error in loadCategories:', error);
                showNotification('Erro ao carregar categorias: ' + error.message, 'error');
                categories = [];
                updateCategoriesDisplay();
                updateCategorySelects();
            }
        }

        async function saveCategory(categoryData) {
            try {
                // Check limits for free users
                if (userPlan === 'free' && !editingCategoryId && categories.length >= 3) {
                    showNotification('Limite de 3 categorias atingido. Fa√ßa upgrade para Premium!', 'warning');
                    return;
                }

                const categoryPayload = {
                    ...categoryData,
                    user_id: currentUser.id,
                    created_at: editingCategoryId ? undefined : new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };

                if (editingCategoryId) {
                    const { data, error } = await supabase
                        .from('categories')
                        .update(categoryPayload)
                        .eq('id', editingCategoryId)
                        .eq('user_id', currentUser.id)
                        .select()
                        .single();

                    if (error) throw error;
                    console.log('Category updated:', data);
                    showNotification('Categoria atualizada com sucesso!', 'success');
                } else {
                    const { data, error } = await supabase
                        .from('categories')
                        .insert([categoryPayload])
                        .select()
                        .single();

                    if (error) throw error;
                    console.log('Category created:', data);
                    showNotification('Categoria criada com sucesso!', 'success');
                }

                await loadCategories();
                closeCategoryModal();
            } catch (error) {
                console.error('Error saving category:', error);
                showNotification('Erro ao salvar categoria: ' + error.message, 'error');
            }
        }

        async function deleteCategory(categoryId) {
            if (!confirm('Tem certeza que deseja excluir esta categoria?')) return;

            try {
                const { error } = await supabase
                    .from('categories')
                    .delete()
                    .eq('id', categoryId);

                if (error) throw error;

                showNotification('Categoria exclu√≠da com sucesso!', 'success');
                await loadCategories();
                await loadTasks(); // Reload tasks to update display
            } catch (error) {
                showNotification('Erro ao excluir categoria: ' + error.message, 'error');
            }
        }

        // Account management
        async function deleteAccount() {
            const confirmation = prompt('Digite "EXCLUIR" para confirmar a exclus√£o permanente da sua conta:');
            if (confirmation !== 'EXCLUIR') return;

            try {
                // Delete user data
                await supabase.from('tasks').delete().eq('user_id', currentUser.id);
                await supabase.from('categories').delete().eq('user_id', currentUser.id);
                await supabase.from('profiles').delete().eq('id', currentUser.id);

                // Delete auth user (this might not work from client-side)
                showNotification('Conta exclu√≠da com sucesso!', 'success');
                await logout();
            } catch (error) {
                showNotification('Erro ao excluir conta: ' + error.message, 'error');
            }
        }

        async function exportData() {
            try {
                const userData = {
                    user: currentUser,
                    tasks: tasks,
                    categories: categories,
                    exported_at: new Date().toISOString()
                };

                const dataStr = JSON.stringify(userData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `deadlinex-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                showNotification('Dados exportados com sucesso!', 'success');
            } catch (error) {
                showNotification('Erro ao exportar dados: ' + error.message, 'error');
            }
        }

        // UI functions
        function showLogin() {
            loginScreen.classList.remove('hidden');
            registerScreen.classList.add('hidden');
            forgotPasswordScreen.classList.add('hidden');
            dashboard.classList.add('hidden');
        }

        function showRegister() {
            loginScreen.classList.add('hidden');
            registerScreen.classList.remove('hidden');
            forgotPasswordScreen.classList.add('hidden');
            dashboard.classList.add('hidden');
        }

        function showForgotPassword() {
            loginScreen.classList.add('hidden');
            registerScreen.classList.add('hidden');
            forgotPasswordScreen.classList.remove('hidden');
            dashboard.classList.add('hidden');
        }

        function showDashboard() {
            loginScreen.classList.add('hidden');
            registerScreen.classList.add('hidden');
            forgotPasswordScreen.classList.add('hidden');
            dashboard.classList.remove('hidden');
            
            if (currentUser) {
                document.getElementById('userName').textContent = 
                    currentUser.user_metadata?.full_name || currentUser.email;
            }
        }

        function showTaskModal(task = null) {
            editingTaskId = task ? task.id : null;
            
            if (task) {
                document.getElementById('modalTitle').textContent = 'Editar Tarefa';
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description || '';
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskStatus').value = task.status;
                document.getElementById('taskCategory').value = task.category_id || '';
                document.getElementById('taskDueDate').value = task.due_date ? 
                    new Date(task.due_date).toISOString().slice(0, 16) : '';
            } else {
                document.getElementById('modalTitle').textContent = 'Nova Tarefa';
                document.getElementById('taskForm').reset();
            }
            
            taskModal.classList.remove('hidden');
        }

        function closeTaskModal() {
            taskModal.classList.add('hidden');
            editingTaskId = null;
        }

        function showCategoryModal(category = null) {
            editingCategoryId = category ? category.id : null;
            
            if (category) {
                document.getElementById('categoryModalTitle').textContent = 'Editar Categoria';
                document.getElementById('categoryName').value = category.name;
                document.getElementById('categoryDescription').value = category.description || '';
                document.getElementById('categoryColor').value = category.color || '#3b82f6';
                document.getElementById('categoryColorText').value = category.color || '#3b82f6';
            } else {
                document.getElementById('categoryModalTitle').textContent = 'Nova Categoria';
                document.getElementById('categoryForm').reset();
                document.getElementById('categoryColor').value = '#3b82f6';
                document.getElementById('categoryColorText').value = '#3b82f6';
            }
            
            categoryModal.classList.remove('hidden');
        }

        function closeCategoryModal() {
            categoryModal.classList.add('hidden');
            editingCategoryId = null;
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function updateStats() {
            const total = tasks.length;
            const pending = tasks.filter(t => t.status === 'pending').length;
            const completed = tasks.filter(t => t.status === 'completed').length;
            const overdue = tasks.filter(t => {
                return t.status !== 'completed' && new Date(t.due_date) < new Date();
            }).length;

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('pendingTasks').textContent = pending;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('overdueTasks').textContent = overdue;
        }

        function updateTasksDisplay() {
            updateRecentTasks();
            updateAllTasks();
        }

        function updateRecentTasks() {
            const container = document.getElementById('recentTasksList');
            const recentTasks = tasks.slice(0, 5);

            if (recentTasks.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma tarefa encontrada</p>';
                return;
            }

            container.innerHTML = recentTasks.map(task => createTaskCard(task, true)).join('');
        }

        function updateAllTasks() {
            const container = document.getElementById('tasksList');
            let filteredTasks = [...tasks];

            // Apply filters
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const searchTerm = document.getElementById('searchTasks').value.toLowerCase();

            if (statusFilter) {
                filteredTasks = filteredTasks.filter(task => task.status === statusFilter);
            }

            if (priorityFilter) {
                filteredTasks = filteredTasks.filter(task => task.priority === priorityFilter);
            }

            if (categoryFilter) {
                filteredTasks = filteredTasks.filter(task => task.category_id === categoryFilter);
            }

            if (searchTerm) {
                filteredTasks = filteredTasks.filter(task => 
                    task.title.toLowerCase().includes(searchTerm) ||
                    (task.description && task.description.toLowerCase().includes(searchTerm))
                );
            }

            if (filteredTasks.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma tarefa encontrada</p>';
                return;
            }

            container.innerHTML = filteredTasks.map(task => createTaskCard(task, false)).join('');
        }

        function updateCategoriesDisplay() {
            const container = document.getElementById('categoriesList');

            if (categories.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8 col-span-3">Nenhuma categoria encontrada</p>';
                return;
            }

            container.innerHTML = categories.map(category => createCategoryCard(category)).join('');
        }

        function updateCategorySelects() {
            const taskCategorySelect = document.getElementById('taskCategory');
            const categoryFilterSelect = document.getElementById('categoryFilter');

            // Clear existing options (except first)
            taskCategorySelect.innerHTML = '<option value="">Sem categoria</option>';
            categoryFilterSelect.innerHTML = '<option value="">Todas as Categorias</option>';

            categories.forEach(category => {
                const option1 = new Option(category.name, category.id);
                const option2 = new Option(category.name, category.id);
                taskCategorySelect.add(option1);
                categoryFilterSelect.add(option2);
            });
        }

        function createTaskCard(task, isRecent = false) {
            const isOverdue = task.status !== 'completed' && new Date(task.due_date) < new Date();
            const priorityClass = `priority-${task.priority}`;
            const statusClass = `status-${isOverdue ? 'overdue' : task.status}`;
            
            let cardClass = 'task-card normal';
            if (isOverdue) cardClass = 'task-card urgent';
            else if (task.priority === 'urgent' || task.priority === 'high') cardClass = 'task-card warning';

            const dueDate = new Date(task.due_date).toLocaleString('pt-BR');
            
            // Handle category - can be from join or from categories array
            let category = null;
            if (task.categories) {
                category = task.categories; // From join
            } else if (task.category_id) {
                category = categories.find(c => c.id === task.category_id); // From array
            }

            return `
                <div class="${cardClass} bg-white p-4 rounded-lg border hover:shadow-md transition-all">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-800 mb-2">${task.title}</h3>
                            ${task.description ? `<p class="text-gray-600 text-sm mb-3">${task.description}</p>` : ''}
                            
                            <div class="flex items-center space-x-3 text-sm flex-wrap gap-2">
                                <span class="priority-badge ${priorityClass}">${getPriorityLabel(task.priority)}</span>
                                <span class="status-badge ${statusClass}">${getStatusLabel(task.status, isOverdue)}</span>
                                ${category ? `<span class="category-badge" style="background-color: ${category.color}20; color: ${category.color};">${category.name}</span>` : ''}
                                <span class="text-gray-500">
                                    <i class="fas fa-clock mr-1"></i>${dueDate}
                                </span>
                            </div>
                        </div>
                        
                        ${!isRecent ? `
                            <div class="flex items-center space-x-2 ml-4">
                                <button onclick="editTask('${task.id}')" 
                                        class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteTask('${task.id}')" 
                                        class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Helper function for editing tasks
        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                showTaskModal(task);
            }
        }

        function createCategoryCard(category) {
            const taskCount = tasks.filter(t => t.category_id === category.id).length;

            return `
                <div class="bg-white rounded-xl p-6 shadow-sm border">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-4 h-4 rounded-full mr-3" style="background-color: ${category.color};"></div>
                            <h3 class="font-semibold text-gray-800">${category.name}</h3>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="editCategory('${category.id}')" 
                                    class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteCategory('${category.id}')" 
                                    class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    ${category.description ? `<p class="text-gray-600 text-sm mb-4">${category.description}</p>` : ''}
                    
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-tasks mr-1"></i>
                        ${taskCount} tarefa${taskCount !== 1 ? 's' : ''}
                    </div>
                </div>
            `;
        }

        // Helper function for editing categories
        function editCategory(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            if (category) {
                showCategoryModal(category);
            }
        }

        function getPriorityLabel(priority) {
            const labels = {
                low: 'Baixa',
                medium: 'M√©dia',
                high: 'Alta',
                urgent: 'Urgente'
            };
            return labels[priority] || priority;
        }

        function getStatusLabel(status, isOverdue = false) {
            if (isOverdue) return 'Atrasada';
            
            const labels = {
                pending: 'Pendente',
                in_progress: 'Em Andamento',
                completed: 'Conclu√≠da'
            };
            return labels[status] || status;
        }

        // Navigation
        function showTab(tabName) {
            // Hide all content
            document.getElementById('dashboardContent').classList.add('hidden');
            document.getElementById('tasksContent').classList.add('hidden');
            document.getElementById('categoriesContent').classList.add('hidden');
            document.getElementById('calendarContent').classList.add('hidden');
            document.getElementById('reportsContent').classList.add('hidden');
            document.getElementById('premiumContent').classList.add('hidden');
            document.getElementById('settingsContent').classList.add('hidden');

            // Show selected content
            document.getElementById(tabName + 'Content').classList.remove('hidden');

            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                tasks: 'Tarefas',
                categories: 'Categorias',
                calendar: 'Calend√°rio',
                reports: 'Relat√≥rios',
                premium: 'Premium',
                settings: 'Configura√ß√µes'
            };
            document.getElementById('pageTitle').textContent = titles[tabName];

            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active', 'bg-indigo-50', 'text-indigo-600');
            });
            document.getElementById(tabName + 'Tab').classList.add('active', 'bg-indigo-50', 'text-indigo-600');
        }

        // Event listeners
        function setupEventListeners() {
            // Auth forms
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                await login(email, password);
            });

            document.getElementById('registerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                await register(email, password, name);
            });

            document.getElementById('forgotPasswordForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('forgotEmail').value;
                await forgotPassword(email);
            });

            // Navigation
            document.getElementById('showRegister').addEventListener('click', showRegister);
            document.getElementById('showLogin').addEventListener('click', showLogin);
            document.getElementById('showForgotPassword').addEventListener('click', showForgotPassword);
            document.getElementById('backToLogin').addEventListener('click', showLogin);
            document.getElementById('logoutBtn').addEventListener('click', logout);

            // Terms and Privacy
            document.getElementById('showTerms').addEventListener('click', () => {
                termsModal.classList.remove('hidden');
            });

            document.getElementById('showPrivacy').addEventListener('click', () => {
                privacyModal.classList.remove('hidden');
            });

            document.getElementById('closeTerms').addEventListener('click', () => {
                termsModal.classList.add('hidden');
            });

            document.getElementById('closePrivacy').addEventListener('click', () => {
                privacyModal.classList.add('hidden');
            });

            document.getElementById('termsModalOverlay').addEventListener('click', () => {
                termsModal.classList.add('hidden');
            });

            document.getElementById('privacyModalOverlay').addEventListener('click', () => {
                privacyModal.classList.add('hidden');
            });

            // Sidebar
            document.getElementById('openSidebar').addEventListener('click', () => {
                sidebar.classList.remove('sidebar-hidden');
            });

            document.getElementById('closeSidebar').addEventListener('click', () => {
                sidebar.classList.add('sidebar-hidden');
            });

            // Navigation tabs
            document.getElementById('dashboardTab').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('dashboard');
            });

            document.getElementById('tasksTab').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('tasks');
            });

            document.getElementById('categoriesTab').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('categories');
            });

            document.getElementById('calendarTab').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('calendar');
            });

            document.getElementById('reportsTab').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('reports');
            });

            document.getElementById('premiumTab').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('premium');
            });

            document.getElementById('settingsTab').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('settings');
            });

            // Task modal
            document.getElementById('addTaskBtn').addEventListener('click', () => showTaskModal());
            document.getElementById('cancelTask').addEventListener('click', closeTaskModal);
            document.getElementById('modalOverlay').addEventListener('click', closeTaskModal);

            document.getElementById('taskForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const taskData = {
                    title: document.getElementById('taskTitle').value,
                    description: document.getElementById('taskDescription').value,
                    priority: document.getElementById('taskPriority').value,
                    status: document.getElementById('taskStatus').value,
                    category_id: document.getElementById('taskCategory').value || null,
                    due_date: document.getElementById('taskDueDate').value
                };

                await saveTask(taskData);
            });

            // Category modal
            document.getElementById('addCategoryBtn').addEventListener('click', () => showCategoryModal());
            document.getElementById('cancelCategory').addEventListener('click', closeCategoryModal);
            document.getElementById('categoryModalOverlay').addEventListener('click', closeCategoryModal);

            document.getElementById('categoryForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const categoryData = {
                    name: document.getElementById('categoryName').value,
                    description: document.getElementById('categoryDescription').value,
                    color: document.getElementById('categoryColor').value
                };

                await saveCategory(categoryData);
            });

            // Color picker sync
            document.getElementById('categoryColor').addEventListener('change', (e) => {
                document.getElementById('categoryColorText').value = e.target.value;
            });

            document.getElementById('categoryColorText').addEventListener('change', (e) => {
                document.getElementById('categoryColor').value = e.target.value;
            });

            // Filters
            document.getElementById('statusFilter').addEventListener('change', updateAllTasks);
            document.getElementById('priorityFilter').addEventListener('change', updateAllTasks);
            document.getElementById('categoryFilter').addEventListener('change', updateAllTasks);
            document.getElementById('searchTasks').addEventListener('input', updateAllTasks);

            // Settings
            document.getElementById('deleteAccountBtn').addEventListener('click', deleteAccount);
            document.getElementById('exportDataBtn').addEventListener('click', exportData);

            // Premium
            document.getElementById('upgradeToPremium').addEventListener('click', () => {
                showNotification('Funcionalidade de pagamento em desenvolvimento!', 'warning');
            });

            // Close sidebar on outside click (mobile)
            document.addEventListener('click', (e) => {
                if (window.innerWidth < 768 && 
                    !sidebar.contains(e.target) && 
                    !document.getElementById('openSidebar').contains(e.target)) {
                    sidebar.classList.add('sidebar-hidden');
                }
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97fa2bb65605f3f1',t:'MTc1Nzk2MDc2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>




























