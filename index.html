<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeadlineX - Sistema de Gest√£o de Prazos</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="DeadlineX">
    <meta name="description" content="Sistema profissional de gest√£o de prazos com notifica√ß√µes inteligentes">
    
    <!-- Favicon e Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23667eea;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23764ba2;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23grad)'/%3E%3Ctext x='50' y='35' font-family='Arial,sans-serif' font-size='24' font-weight='bold' text-anchor='middle' fill='white'%3E12:34%3C/text%3E%3Ctext x='50' y='55' font-family='Arial,sans-serif' font-size='12' text-anchor='middle' fill='white'%3EDEADLINE%3C/text%3E%3Ctext x='50' y='75' font-family='Arial,sans-serif' font-size='8' text-anchor='middle' fill='white'%3EMANAGER%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23667eea;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23764ba2;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23grad)'/%3E%3Ctext x='50' y='35' font-family='Arial,sans-serif' font-size='24' font-weight='bold' text-anchor='middle' fill='white'%3E12:34%3C/text%3E%3Ctext x='50' y='55' font-family='Arial,sans-serif' font-size='12' text-anchor='middle' fill='white'%3EDEADLINE%3C/text%3E%3Ctext x='50' y='75' font-family='Arial,sans-serif' font-size='8' text-anchor='middle' fill='white'%3EMANAGER%3C/text%3E%3C/svg%3E">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRGVhZGxpbmVYIiwic2hvcnRfbmFtZSI6IkRlYWRsaW5lWCIsImRlc2NyaXB0aW9uIjoiU2lzdGVtYSBwcm9maXNzaW9uYWwgZGUgZ2VzdMOjbyBkZSBwcmF6b3MgY29tIG5vdGlmaWNhw6fDtWVzIGludGVsaWdlbnRlcyIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjNjY3ZWVhIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTAwIDEwMCclM0UlM0NkZWZzJTNFJTNDbGluZWFyR3JhZGllbnQgaWQ9J2dyYWQnIHgxPScwJTI1JyB5MT0nMCUyNScgeDI9JzEwMCUyNScgeTI9JzEwMCUyNSclM0UlM0NzdG9wIG9mZnNldD0nMCUyNScgc3R5bGU9J3N0b3AtY29sb3I6JTIzNjY3ZWVhO3N0b3Atb3BhY2l0eToxJyAvJTNFJTNDc3RvcCBvZmZzZXQ9JzEwMCUyNScgc3R5bGU9J3N0b3AtY29sb3I6JTIzNzY0YmEyO3N0b3Atb3BhY2l0eToxJyAvJTNFJTNDL2xpbmVhckdyYWRpZW50JTNFJTNDL2RlZnMlM0UlM0NyZWN0IHdpZHRoPScxMDAnIGhlaWdodD0nMTAwJyByeD0nMjAnIGZpbGw9J3VybCglMjNncmFkKScvJTNFJTNDdGV4dCB4PSc1MCcgeT0nMzUnIGZvbnQtZmFtaWx5PSdBcmlhbCxzYW5zLXNlcmlmJyBmb250LXNpemU9JzI0JyBmb250LXdlaWdodD0nYm9sZCcgdGV4dC1hbmNob3I9J21pZGRsZScgZmlsbD0nd2hpdGUnJTNFMTI6MzQlM0MvdGV4dCUzRSUzQ3RleHQgeD0nNTAnIHk9JzU1JyBmb250LWZhbWlseT0nQXJpYWwsc2Fucy1zZXJpZicgZm9udC1zaXplPScxMicgdGV4dC1hbmNob3I9J21pZGRsZScgZmlsbD0nd2hpdGUnJTNFREVBRExJTkUlM0MvdGV4dCUzRSUzQ3RleHQgeD0nNTAnIHk9Jzc1JyBmb250LWZhbWlseT0nQXJpYWwsc2Fucy1zZXJpZicgZm9udC1zaXplPSc4JyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBmaWxsPSd3aGl0ZSclM0VNQU5BR0VSJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .btn-large { padding: 1rem 1.5rem; font-size: 1.1rem; min-height: 3.5rem; }
        .mobile-optimized { touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        
        /* PWA Install Button Animation */
        .install-prompt {
            animation: slideInUp 0.5s ease-out;
        }
        @keyframes slideInUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Logo Animation */
        .logo-pulse {
            animation: logoPulse 3s ease-in-out infinite;
        }
        @keyframes logoPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen mobile-optimized">
    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4 z-50 hidden install-prompt">
        <div class="flex items-center justify-between max-w-md mx-auto">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                    </svg>
                </div>
                <div>
                    <p class="font-semibold text-sm">Instalar DeadlineX</p>
                    <p class="text-xs opacity-90">Adicione √† tela inicial</p>
                </div>
            </div>
            <div class="flex space-x-2">
                <button id="installBtn" class="bg-white text-purple-600 px-4 py-2 rounded-lg text-sm font-semibold hover:bg-gray-100 transition-colors">
                    Instalar
                </button>
                <button id="dismissInstall" class="text-white opacity-75 hover:opacity-100 p-2">
                    ‚úï
                </button>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full card-shadow">
            <!-- Logo -->
            <div class="text-center mb-8">
                <div class="inline-block logo-pulse">
                    <svg width="80" height="80" viewBox="0 0 100 100" class="mx-auto mb-4">
                        <defs>
                            <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <rect width="100" height="100" rx="20" fill="url(#logoGrad)"/>
                        <text x="50" y="35" font-family="Inter,sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="white">12:34</text>
                        <text x="50" y="55" font-family="Inter,sans-serif" font-size="12" text-anchor="middle" fill="white">DEADLINE</text>
                        <text x="50" y="75" font-family="Inter,sans-serif" font-size="8" text-anchor="middle" fill="white">MANAGER</text>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">DeadlineX</h1>
                <p class="text-gray-600">Sistema Profissional de Gest√£o de Prazos</p>
            </div>
            
            <!-- Abas Login/Cadastro -->
            <div class="flex mb-6 bg-gray-100 rounded-lg p-1">
                <button id="loginTab" class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-white text-purple-600 shadow-sm">
                    Entrar
                </button>
                <button id="registerTab" class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800">
                    Cadastrar
                </button>
            </div>

            <!-- Formul√°rio de Login -->
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="userIdentifier" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-lg" placeholder="Digite seu email" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <div class="relative">
                        <input type="password" id="userPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-lg pr-12" placeholder="Digite sua senha" required>
                        <button type="button" id="toggleLoginPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-semibold text-lg hover:from-purple-700 hover:to-blue-700 transition-all duration-200 transform hover:scale-105">
                    Entrar no Sistema
                </button>
            </form>

            <!-- Formul√°rio de Cadastro -->
            <form id="registerForm" class="space-y-6 hidden">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                    <input type="text" id="registerName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-lg" placeholder="Digite seu nome completo" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="registerEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-lg" placeholder="Digite seu email" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <div class="relative">
                        <input type="password" id="registerPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-lg pr-12" placeholder="Crie uma senha segura" required>
                        <button type="button" id="toggleRegisterPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                            üëÅÔ∏è
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">M√≠nimo 6 caracteres</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Senha</label>
                    <div class="relative">
                        <input type="password" id="confirmPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-lg pr-12" placeholder="Digite a senha novamente" required>
                        <button type="button" id="toggleConfirmPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Telefone (opcional)</label>
                    <input type="tel" id="registerPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-lg" placeholder="(11) 99999-9999">
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 rounded-lg font-semibold text-lg hover:from-green-700 hover:to-blue-700 transition-all duration-200 transform hover:scale-105">
                    Criar Conta
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-xs text-gray-500">Seus dados ficam seguros e privados</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="gradient-bg text-white shadow-lg sticky top-0 z-40">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <svg width="40" height="40" viewBox="0 0 100 100" class="flex-shrink-0">
                            <defs>
                                <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.9" />
                                    <stop offset="100%" style="stop-color:#ffffff;stop-opacity:0.7" />
                                </linearGradient>
                            </defs>
                            <rect width="100" height="100" rx="20" fill="url(#headerGrad)"/>
                            <text x="50" y="35" font-family="Inter,sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#667eea">12:34</text>
                            <text x="50" y="55" font-family="Inter,sans-serif" font-size="12" text-anchor="middle" fill="#667eea">DEADLINE</text>
                            <text x="50" y="75" font-family="Inter,sans-serif" font-size="8" text-anchor="middle" fill="#667eea">MANAGER</text>
                        </svg>
                        <div>
                            <h1 class="text-xl md:text-2xl font-bold">DeadlineX</h1>
                            <p class="text-xs opacity-75" id="userWelcome">Bem-vindo!</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="shareBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 md:px-4 md:py-2 rounded-lg transition-colors text-sm md:text-base">
                            <span class="hidden md:inline">üì§ Compartilhar</span>
                            <span class="md:hidden">üì§</span>
                        </button>
                        <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 p-2 md:px-4 md:py-2 rounded-lg transition-colors text-sm md:text-base">
                            <span class="hidden md:inline">Sair</span>
                            <span class="md:hidden">üö™</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Container -->
        <div class="container mx-auto px-4 py-6">
            <!-- Action Buttons -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <button id="newDeadlineBtn" class="bg-green-500 hover:bg-green-600 text-white btn-large rounded-xl font-semibold transition-all duration-200 transform hover:scale-105 card-shadow flex flex-col items-center space-y-2">
                    <span class="text-2xl">‚ûï</span>
                    <span class="text-sm md:text-base">Novo Prazo</span>
                </button>
                <button id="installAppBtn" class="bg-blue-500 hover:bg-blue-600 text-white btn-large rounded-xl font-semibold transition-all duration-200 transform hover:scale-105 card-shadow flex flex-col items-center space-y-2">
                    <span class="text-2xl">üì±</span>
                    <span class="text-sm md:text-base">Instalar App</span>
                </button>
                <button id="notificationBtn" class="bg-purple-500 hover:bg-purple-600 text-white btn-large rounded-xl font-semibold transition-all duration-200 transform hover:scale-105 card-shadow flex flex-col items-center space-y-2">
                    <span class="text-2xl">üîî</span>
                    <span class="text-sm md:text-base">Notifica√ß√µes</span>
                </button>
                <button id="refreshBtn" class="bg-orange-500 hover:bg-orange-600 text-white btn-large rounded-xl font-semibold transition-all duration-200 transform hover:scale-105 card-shadow flex flex-col items-center space-y-2">
                    <span class="text-2xl">üîÑ</span>
                    <span class="text-sm md:text-base">Atualizar</span>
                </button>
            </div>

            <!-- Statistics Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-8">
                <div class="bg-white p-4 md:p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-xs md:text-sm">Total</p>
                            <p id="totalCount" class="text-xl md:text-2xl font-bold text-gray-800">0</p>
                        </div>
                        <div class="bg-blue-100 p-2 md:p-3 rounded-full">
                            <svg class="w-4 h-4 md:w-6 md:h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 md:p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-xs md:text-sm">Urgentes</p>
                            <p id="urgentCount" class="text-xl md:text-2xl font-bold text-red-600 pulse-animation">0</p>
                        </div>
                        <div class="bg-red-100 p-2 md:p-3 rounded-full">
                            <svg class="w-4 h-4 md:w-6 md:h-6 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 md:p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-xs md:text-sm">Esta Semana</p>
                            <p id="weekCount" class="text-xl md:text-2xl font-bold text-orange-600">0</p>
                        </div>
                        <div class="bg-orange-100 p-2 md:p-3 rounded-full">
                            <svg class="w-4 h-4 md:w-6 md:h-6 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5a2.25 2.25 0 002.25-2.25m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5a2.25 2.25 0 012.25 2.25v7.5"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 md:p-6 rounded-xl card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-xs md:text-sm">Conclu√≠dos</p>
                            <p id="completedCount" class="text-xl md:text-2xl font-bold text-green-600">0</p>
                        </div>
                        <div class="bg-green-100 p-2 md:p-3 rounded-full">
                            <svg class="w-4 h-4 md:w-6 md:h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Connection Status -->
            <div id="connectionStatus" class="mb-4 p-3 rounded-lg text-sm font-medium hidden">
            </div>

            <!-- Deadlines List -->
            <div class="bg-white rounded-xl card-shadow">
                <div class="p-4 md:p-6 border-b border-gray-200">
                    <h2 class="text-lg md:text-xl font-semibold text-gray-800">Meus Prazos</h2>
                </div>
                <div id="deadlinesList" class="p-4 md:p-6">
                    <div class="text-center text-gray-500 py-8">
                        <svg class="w-12 h-12 md:w-16 md:h-16 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <p>Carregando prazos...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hidden WhatsApp Section (for future use) -->
        <div id="whatsappSection" class="hidden">
            <button id="testWhatsappBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg">
                üì± Testar WhatsApp
            </button>
            <button id="configBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                ‚öôÔ∏è Configurar WhatsApp
            </button>
        </div>
    </div>

    <!-- Modal: Novo/Editar Prazo -->
    <div id="deadlineModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl max-w-md w-full p-6 max-h-screen overflow-y-auto">
                <h3 id="modalTitle" class="text-lg font-semibold mb-4">Novo Prazo</h3>
                <form id="deadlineForm">
                    <input type="hidden" id="editingId" value="">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√≠tulo</label>
                        <input type="text" id="deadlineTitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                        <select id="deadlineCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="trabalho">üè¢ Trabalho</option>
                            <option value="pessoal">üë§ Pessoal</option>
                            <option value="juridico">‚öñÔ∏è Jur√≠dico</option>
                            <option value="financeiro">üí∞ Financeiro</option>
                            <option value="saude">üè• Sa√∫de</option>
                            <option value="educacao">üìö Educa√ß√£o</option>
                            <option value="aniversarios">üéÇ Anivers√°rios</option>
                            <option value="contratos">üìÑ Contratos</option>
                            <option value="veiculo">üöó Ve√≠culo</option>
                            <option value="viagens">‚úàÔ∏è Viagens</option>
                            <option value="impostos">üßæ Impostos</option>
                            <option value="seguros">üõ°Ô∏è Seguros</option>
                            <option value="documentos">üìã Documentos</option>
                            <option value="eventos">üéâ Eventos</option>
                            <option value="manutencao">üîß Manuten√ß√£o</option>
                            <option value="reunioes">üë• Reuni√µes</option>
                            <option value="outros">üìã Outros</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data e Hora</label>
                        <input type="datetime-local" id="deadlineDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                        <textarea id="deadlineDescription" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" rows="3"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancelDeadline" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancelar</button>
                        <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Configurar WhatsApp (Hidden) -->
    <div id="configModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl max-w-md w-full p-6">
                <h3 class="text-lg font-semibold mb-4">Configurar WhatsApp</h3>
                <form id="configForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Seu N√∫mero do WhatsApp</label>
                        <input type="tel" id="whatsappNumber" placeholder="5511999999999" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                        <p class="text-xs text-gray-500 mt-1">Formato: 5511999999999 (c√≥digo do pa√≠s + DDD + n√∫mero)</p>
                    </div>
                    <div class="mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="enableNotifications" class="mr-2">
                            <span class="text-sm text-gray-700">Ativar notifica√ß√µes autom√°ticas</span>
                        </label>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancelConfig" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancelar</button>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ===== SISTEMA DE VERSIONAMENTO =====
        const SYSTEM_VERSION = 'DeadlineX-v3.0-SupabaseOnly';
        console.log(`üöÄ ${SYSTEM_VERSION} - Sistema 100% Supabase`);
        
        // ===== SISTEMA DE DEBUG AVAN√áADO =====
        window.debugMode = true;
        
        function debugLog(message, data = null) {
            if (window.debugMode) {
                console.log(`üîç [DEBUG] ${message}`, data || '');
            }
        }
        
        function errorLog(message, error = null) {
            console.error(`‚ùå [ERRO] ${message}`, error || '');
            if (error) {
                console.error('Stack trace:', error.stack);
            }
        }

        // ===== CONFIGURA√á√ÉO SUPABASE =====
        const SUPABASE_URL = 'https://vastjlzaxafpoagptklu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhc3RqbHpheGFmcG9hZ3B0a2x1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyNjUzMDEsImV4cCI6MjA3MTg0MTMwMX0.4EnnkdyVDEo1qSp1C2-QgVlklUkL2W3ulqOmXX_DiVY';
        
        let supabase;
        let currentUser = null;
        let deferredPrompt = null;
        
        // Inicializar Supabase
        try {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('‚úÖ Supabase inicializado');
        } catch (error) {
            console.error('‚ùå Erro ao inicializar Supabase:', error);
        }

        // ===== ESTADO DA APLICA√á√ÉO =====
        let deadlines = [];
        let userConfig = {
            whatsappNumber: '',
            enableNotifications: false
        };

        // ===== ELEMENTOS DOM =====
        const elements = {
            loginScreen: document.getElementById('loginScreen'),
            mainApp: document.getElementById('mainApp'),
            loginForm: document.getElementById('loginForm'),
            registerForm: document.getElementById('registerForm'),
            loginTab: document.getElementById('loginTab'),
            registerTab: document.getElementById('registerTab'),
            userIdentifier: document.getElementById('userIdentifier'),
            userPassword: document.getElementById('userPassword'),
            userWelcome: document.getElementById('userWelcome'),
            
            newDeadlineBtn: document.getElementById('newDeadlineBtn'),
            installAppBtn: document.getElementById('installAppBtn'),
            notificationBtn: document.getElementById('notificationBtn'),
            refreshBtn: document.getElementById('refreshBtn'),
            shareBtn: document.getElementById('shareBtn'),
            logoutBtn: document.getElementById('logoutBtn'),
            
            deadlineModal: document.getElementById('deadlineModal'),
            deadlineForm: document.getElementById('deadlineForm'),
            modalTitle: document.getElementById('modalTitle'),
            editingId: document.getElementById('editingId'),
            
            deadlinesList: document.getElementById('deadlinesList'),
            totalCount: document.getElementById('totalCount'),
            urgentCount: document.getElementById('urgentCount'),
            weekCount: document.getElementById('weekCount'),
            completedCount: document.getElementById('completedCount'),
            connectionStatus: document.getElementById('connectionStatus'),
            
            installPrompt: document.getElementById('installPrompt'),
            installBtn: document.getElementById('installBtn'),
            dismissInstall: document.getElementById('dismissInstall')
        };

        // ===== PWA E INSTALA√á√ÉO =====
        
        // Detectar se pode ser instalado
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Mostrar prompt autom√°tico na primeira visita
            if (!localStorage.getItem('installPromptShown')) {
                setTimeout(() => {
                    elements.installPrompt.classList.remove('hidden');
                    localStorage.setItem('installPromptShown', 'true');
                }, 3000);
            }
        });

        // Bot√£o instalar no prompt
        elements.installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`PWA install: ${outcome}`);
                deferredPrompt = null;
            }
            elements.installPrompt.classList.add('hidden');
        });

        // Dispensar prompt
        elements.dismissInstall.addEventListener('click', () => {
            elements.installPrompt.classList.add('hidden');
        });

        // Bot√£o instalar no app
        elements.installAppBtn.addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
            } else {
                // Instru√ß√µes manuais
                alert('Para instalar:\n\nüì± Mobile: Toque no menu do navegador > "Adicionar √† tela inicial"\n\nüíª Desktop: Clique no √≠cone de instala√ß√£o na barra de endere√ßos');
            }
        });

        // ===== NOTIFICA√á√ïES PUSH =====
        
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    showConnectionStatus('Notifica√ß√µes ativadas com sucesso! üîî', 'success');
                    scheduleNotifications();
                } else {
                    showConnectionStatus('Permiss√£o de notifica√ß√£o negada', 'error');
                }
            } else {
                showConnectionStatus('Notifica√ß√µes n√£o suportadas neste navegador', 'error');
            }
        }

        function scheduleNotifications() {
            // Limpar notifica√ß√µes anteriores
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(registration => {
                    registration.getNotifications().then(notifications => {
                        notifications.forEach(notification => notification.close());
                    });
                });
            }

            deadlines.forEach(deadline => {
                if (deadline.completed) return;

                const deadlineDate = new Date(deadline.date);
                const now = new Date();

                // Notifica√ß√£o 3 dias antes
                const threeDaysBefore = new Date(deadlineDate.getTime() - 3 * 24 * 60 * 60 * 1000);
                if (threeDaysBefore > now) {
                    scheduleNotification(deadline, threeDaysBefore, '3 dias');
                }

                // Notifica√ß√£o 1 dia antes
                const oneDayBefore = new Date(deadlineDate.getTime() - 24 * 60 * 60 * 1000);
                if (oneDayBefore > now) {
                    scheduleNotification(deadline, oneDayBefore, '1 dia');
                }

                // Notifica√ß√£o 2 horas antes
                const twoHoursBefore = new Date(deadlineDate.getTime() - 2 * 60 * 60 * 1000);
                if (twoHoursBefore > now) {
                    scheduleNotification(deadline, twoHoursBefore, '2 horas');
                }
            });
        }

        function scheduleNotification(deadline, notifyTime, timeText) {
            const delay = notifyTime.getTime() - new Date().getTime();
            
            if (delay > 0) {
                setTimeout(() => {
                    if ('serviceWorker' in navigator && 'Notification' in window) {
                        navigator.serviceWorker.ready.then(registration => {
                            registration.showNotification(`‚è∞ Prazo em ${timeText}!`, {
                                body: `${deadline.title}\nVence: ${formatDate(new Date(deadline.date))}`,
                                icon: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Cdefs%3E%3ClinearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%"%3E%3Cstop offset="0%" style="stop-color:%23667eea;stop-opacity:1" /%3E%3Cstop offset="100%" style="stop-color:%23764ba2;stop-opacity:1" /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width="100" height="100" rx="20" fill="url(%23grad)"/%3E%3Ctext x="50" y="35" font-family="Arial,sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="white"%3E12:34%3C/text%3E%3Ctext x="50" y="55" font-family="Arial,sans-serif" font-size="12" text-anchor="middle" fill="white"%3EDEADLINE%3C/text%3E%3Ctext x="50" y="75" font-family="Arial,sans-serif" font-size="8" text-anchor="middle" fill="white"%3EMANAGER%3C/text%3E%3C/svg%3E',
                                badge: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Ccircle cx="50" cy="50" r="50" fill="%23667eea"/%3E%3Ctext x="50" y="60" font-family="Arial,sans-serif" font-size="40" font-weight="bold" text-anchor="middle" fill="white"%3E!%3C/text%3E%3C/svg%3E',
                                tag: `deadline-${deadline.id}`,
                                requireInteraction: true,
                                actions: [
                                    { action: 'view', title: 'Ver Prazo' },
                                    { action: 'dismiss', title: 'Dispensar' }
                                ]
                            });
                        });
                    }
                }, delay);
            }
        }

        elements.notificationBtn.addEventListener('click', requestNotificationPermission);

        // ===== SISTEMA DE COMPARTILHAMENTO =====
        
        elements.shareBtn.addEventListener('click', async () => {
            const shareData = {
                title: 'DeadlineX - Sistema de Gest√£o de Prazos',
                text: 'Organize seus prazos de forma profissional com notifica√ß√µes inteligentes!',
                url: window.location.href
            };

            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                } else {
                    // Fallback para navegadores sem Web Share API
                    const text = `${shareData.title}\n${shareData.text}\n${shareData.url}`;
                    await navigator.clipboard.writeText(text);
                    showConnectionStatus('Link copiado para a √°rea de transfer√™ncia! üìã', 'success');
                }
            } catch (error) {
                console.log('Erro ao compartilhar:', error);
            }
        });

        // ===== SISTEMA DE AUTENTICA√á√ÉO =====
        
        // Alternar entre abas Login/Cadastro
        elements.loginTab.addEventListener('click', () => {
            elements.loginTab.className = "flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-white text-purple-600 shadow-sm";
            elements.registerTab.className = "flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800";
            elements.loginForm.classList.remove('hidden');
            elements.registerForm.classList.add('hidden');
        });

        elements.registerTab.addEventListener('click', () => {
            elements.registerTab.className = "flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-white text-purple-600 shadow-sm";
            elements.loginTab.className = "flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800";
            elements.registerForm.classList.remove('hidden');
            elements.loginForm.classList.add('hidden');
        });

        // Funcionalidade mostrar/ocultar senha
        document.getElementById('toggleLoginPassword').addEventListener('click', function() {
            const passwordField = elements.userPassword;
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        });

        document.getElementById('toggleRegisterPassword').addEventListener('click', function() {
            const passwordField = document.getElementById('registerPassword');
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        });

        document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
            const passwordField = document.getElementById('confirmPassword');
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        });



        // Login
        elements.loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = elements.userIdentifier.value.trim();
            const password = elements.userPassword.value;
            
            debugLog('Tentativa de login:', { email });
            
            if (email && password) {
                try {
                    showConnectionStatus('Fazendo login...', 'info');
                    
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                    
                    if (error) {
                        errorLog('Erro no login:', error);
                        showConnectionStatus('‚ùå ' + error.message, 'error');
                        return;
                    }
                    
                    currentUser = data.user;
                    debugLog('Login bem-sucedido:', currentUser);
                    
                    elements.userWelcome.textContent = `Bem-vindo de volta, ${currentUser.email}!`;
                    
                    elements.loginScreen.classList.add('hidden');
                    elements.mainApp.classList.remove('hidden');
                    
                    await initializeApp();
                    
                } catch (error) {
                    errorLog('Erro cr√≠tico no login:', error);
                    showConnectionStatus('‚ùå Erro de conex√£o', 'error');
                }
            }
        });

        // Cadastro
        elements.registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const phone = document.getElementById('registerPhone').value.trim();
            
            // Valida√ß√µes
            if (!name || !email || !password) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }
            
            if (password.length < 6) {
                alert('A senha deve ter pelo menos 6 caracteres.');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('As senhas n√£o coincidem. Verifique e tente novamente.');
                return;
            }
            
            try {
                showConnectionStatus('Criando conta...', 'info');
                
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            name: name,
                            phone: phone
                        }
                    }
                });
                
                if (error) {
                    errorLog('Erro no cadastro:', error);
                    showConnectionStatus('‚ùå ' + error.message, 'error');
                    return;
                }
                
                currentUser = data.user;
                debugLog('Cadastro bem-sucedido:', currentUser);
                
                elements.userWelcome.textContent = `Bem-vindo, ${name}!`;
                
                elements.loginScreen.classList.add('hidden');
                elements.mainApp.classList.remove('hidden');
                
                // Mostrar mensagem de boas-vindas
                setTimeout(() => {
                    showConnectionStatus(`üéâ Conta criada com sucesso! Bem-vindo ao DeadlineX, ${name}!`, 'success');
                }, 500);
                
                await initializeApp();
                
            } catch (error) {
                errorLog('Erro cr√≠tico no cadastro:', error);
                showConnectionStatus('‚ùå Erro de conex√£o', 'error');
            }
        });

        elements.logoutBtn.addEventListener('click', async () => {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                try {
                    await supabase.auth.signOut();
                    currentUser = null;
                    elements.loginScreen.classList.remove('hidden');
                    elements.mainApp.classList.add('hidden');
                    
                    // Limpar campos de login
                    elements.userIdentifier.value = '';
                    elements.userPassword.value = '';
                    
                    // Limpar campos de cadastro
                    document.getElementById('registerName').value = '';
                    document.getElementById('registerEmail').value = '';
                    document.getElementById('registerPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                    document.getElementById('registerPhone').value = '';
                } catch (error) {
                    console.error('Erro no logout:', error);
                }
            }
        });

        // ===== FUN√á√ïES DE UI =====
        
        function openModal(modalId, editData = null) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            
            if (modalId === 'deadlineModal') {
                if (editData) {
                    elements.modalTitle.textContent = 'Editar Prazo';
                    elements.editingId.value = editData.id;
                    document.getElementById('deadlineTitle').value = editData.title;
                    document.getElementById('deadlineCategory').value = editData.category;
                    document.getElementById('deadlineDate').value = new Date(editData.date).toISOString().slice(0, 16);
                    document.getElementById('deadlineDescription').value = editData.description || '';
                } else {
                    elements.modalTitle.textContent = 'Novo Prazo';
                    elements.editingId.value = '';
                    elements.deadlineForm.reset();
                }
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showConnectionStatus(message, type) {
            const statusEl = elements.connectionStatus;
            statusEl.textContent = message;
            statusEl.className = `mb-4 p-3 rounded-lg text-sm font-medium ${
                type === 'success' ? 'bg-green-100 text-green-800' :
                type === 'error' ? 'bg-red-100 text-red-800' :
                'bg-blue-100 text-blue-800'
            }`;
            statusEl.classList.remove('hidden');
            
            if (type === 'success') {
                setTimeout(() => {
                    statusEl.classList.add('hidden');
                }, 3000);
            }
        }

        // ===== EVENT LISTENERS =====
        
        elements.newDeadlineBtn.addEventListener('click', () => openModal('deadlineModal'));
        elements.refreshBtn.addEventListener('click', loadDeadlines);
        document.getElementById('cancelDeadline').addEventListener('click', () => closeModal('deadlineModal'));
        elements.deadlineForm.addEventListener('submit', saveDeadline);

        // ===== FUN√á√ïES DO BANCO DE DADOS =====
        
        async function initializeDatabase() {
            try {
                // Verificar se as tabelas existem e criar se necess√°rio
                const { error: deadlinesError } = await supabase
                    .from('deadlines')
                    .select('count', { count: 'exact', head: true });

                if (deadlinesError && deadlinesError.code === '42P01') {
                    console.log('Criando tabela deadlines...');
                    // Tabela n√£o existe, mas n√£o podemos criar via JavaScript
                    // Mostrar instru√ß√µes
                    showConnectionStatus('Configure o banco de dados primeiro', 'error');
                    return false;
                }

                return true;
            } catch (error) {
                console.error('Erro ao inicializar banco:', error);
                return false;
            }
        }

        async function saveDeadline(e) {
            e.preventDefault();
            
            debugLog('=== INICIANDO SALVAMENTO DE PRAZO ===');
            
            const isEditing = elements.editingId.value !== '';
            debugLog('Modo de edi√ß√£o:', isEditing);
            debugLog('Usu√°rio atual:', currentUser);
            
            // Validar dados antes de enviar
            const title = document.getElementById('deadlineTitle').value.trim();
            const category = document.getElementById('deadlineCategory').value;
            const date = document.getElementById('deadlineDate').value;
            const description = document.getElementById('deadlineDescription').value.trim();
            
            if (!title || !category || !date) {
                showConnectionStatus('‚ùå Preencha todos os campos obrigat√≥rios', 'error');
                return;
            }
            
            try {
                showConnectionStatus('Salvando prazo...', 'info');
                
                let result;
                
                if (isEditing) {
                    debugLog('=== ATUALIZANDO PRAZO NO SUPABASE ===');
                    
                    const updateData = {
                        title: title,
                        category: category,
                        date: date,
                        description: description
                    };
                    
                    result = await supabase
                        .from('deadlines')
                        .update(updateData)
                        .eq('id', elements.editingId.value)
                        .eq('user_id', currentUser.id)
                        .select();
                        
                } else {
                    debugLog('=== CRIANDO NOVO PRAZO NO SUPABASE ===');
                    
                    const insertData = {
                        title: title,
                        category: category,
                        date: date,
                        description: description,
                        user_id: currentUser.id,
                        completed: false
                    };
                    
                    result = await supabase
                        .from('deadlines')
                        .insert([insertData])
                        .select();
                }
                
                debugLog('Resultado Supabase:', result);
                
                if (result.error) {
                    errorLog('‚ùå Erro no Supabase:', result.error);
                    showConnectionStatus('‚ùå Erro ao salvar: ' + result.error.message, 'error');
                    return;
                }
                
                debugLog('‚úÖ Prazo salvo com sucesso no Supabase');
                showConnectionStatus(`‚úÖ Prazo ${isEditing ? 'atualizado' : 'salvo'} com sucesso!`, 'success');
                
                closeModal('deadlineModal');
                await loadDeadlines();
                scheduleNotifications();
                
            } catch (error) {
                errorLog('‚ùå ERRO CR√çTICO ao salvar prazo:', error);
                showConnectionStatus('‚ùå Erro de conex√£o: ' + error.message, 'error');
            }
        }

        async function loadDeadlines() {
            if (!currentUser) {
                errorLog('Tentativa de carregar prazos sem usu√°rio logado');
                return;
            }

            debugLog('=== CARREGANDO PRAZOS DO SUPABASE ===');
            debugLog('Usu√°rio atual:', currentUser);

            try {
                showConnectionStatus('Carregando prazos...', 'info');
                
                const { data, error } = await supabase
                    .from('deadlines')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('date', { ascending: true });

                debugLog('Resultado do Supabase:', { data, error });

                if (error) {
                    errorLog('‚ùå Erro ao carregar prazos:', error);
                    showConnectionStatus('‚ùå Erro ao carregar: ' + error.message, 'error');
                    deadlines = [];
                } else {
                    deadlines = data || [];
                    debugLog(`‚úÖ ${deadlines.length} prazos carregados do Supabase`);
                    
                    if (deadlines.length > 0) {
                        showConnectionStatus(`‚úÖ ${deadlines.length} prazos carregados!`, 'success');
                    } else {
                        showConnectionStatus('Nenhum prazo encontrado. Crie seu primeiro prazo!', 'info');
                    }
                }
                
                renderDeadlines();
                updateStatistics();
                scheduleNotifications();
                
            } catch (error) {
                errorLog('‚ùå ERRO CR√çTICO ao carregar prazos:', error);
                showConnectionStatus('‚ùå Erro de conex√£o: ' + error.message, 'error');
                
                deadlines = [];
                renderDeadlines();
                updateStatistics();
            }
        }

        function renderDeadlines() {
            const container = elements.deadlinesList;
            
            if (deadlines.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <svg class="w-12 h-12 md:w-16 md:h-16 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <p class="text-base md:text-lg">Nenhum prazo cadastrado ainda.</p>
                        <p class="text-sm text-gray-400">Clique em "Novo Prazo" para come√ßar!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = deadlines.map(deadline => {
                const date = new Date(deadline.date);
                const now = new Date();
                const isUrgent = date <= now && !deadline.completed;
                const isThisWeek = date <= new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000) && !deadline.completed;

                return `
                    <div class="border-l-4 ${
                        deadline.completed ? 'border-green-500 bg-green-50' :
                        isUrgent ? 'border-red-500 bg-red-50' : 
                        isThisWeek ? 'border-orange-500 bg-orange-50' : 
                        'border-gray-300 bg-gray-50'
                    } p-4 mb-4 rounded-r-xl">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800 text-base md:text-lg ${deadline.completed ? 'line-through' : ''}">${deadline.title}</h4>
                                <p class="text-sm text-gray-600">${getCategoryIcon(deadline.category)} ${deadline.category}</p>
                                <p class="text-sm text-gray-500">${formatDate(date)}</p>
                                ${deadline.description ? `<p class="text-sm text-gray-600 mt-2">${deadline.description}</p>` : ''}
                            </div>
                            <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 ml-4">
                                <button onclick="editDeadline(${deadline.id})" class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-100 transition-colors" title="Editar prazo">
                                    <span class="text-lg">‚úèÔ∏è</span>
                                </button>
                                <button onclick="toggleComplete(${deadline.id})" class="text-green-600 hover:text-green-800 p-2 rounded-lg hover:bg-green-100 transition-colors" title="${deadline.completed ? 'Marcar como pendente' : 'Marcar como conclu√≠do'}">
                                    <span class="text-lg">${deadline.completed ? '‚úÖ' : '‚≠ï'}</span>
                                </button>
                                <button onclick="deleteDeadline(${deadline.id})" class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-100 transition-colors" title="Excluir prazo">
                                    <span class="text-lg">üóëÔ∏è</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStatistics() {
            const now = new Date();
            const weekFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);

            const total = deadlines.length;
            const urgent = deadlines.filter(d => !d.completed && new Date(d.date) <= now).length;
            const thisWeek = deadlines.filter(d => !d.completed && new Date(d.date) <= weekFromNow).length;
            const completed = deadlines.filter(d => d.completed).length;

            elements.totalCount.textContent = total;
            elements.urgentCount.textContent = urgent;
            elements.weekCount.textContent = thisWeek;
            elements.completedCount.textContent = completed;
        }

        function getCategoryIcon(category) {
            const icons = {
                trabalho: 'üè¢',
                pessoal: 'üë§',
                juridico: '‚öñÔ∏è',
                financeiro: 'üí∞',
                saude: 'üè•',
                educacao: 'üìö',
                aniversarios: 'üéÇ',
                contratos: 'üìÑ',
                veiculo: 'üöó',
                viagens: '‚úàÔ∏è',
                impostos: 'üßæ',
                seguros: 'üõ°Ô∏è',
                documentos: 'üìã',
                eventos: 'üéâ',
                manutencao: 'üîß',
                reunioes: 'üë•',
                outros: 'üìã'
            };
            return icons[category] || 'üìã';
        }

        function formatDate(date) {
            return date.toLocaleDateString('pt-BR') + ' √†s ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        // ===== FUN√á√ïES GLOBAIS PARA BOT√ïES =====
        
        window.editDeadline = function(id) {
            const deadline = deadlines.find(d => d.id === id);
            if (deadline) {
                openModal('deadlineModal', deadline);
            }
        };

        window.toggleComplete = async function(id) {
            const deadline = deadlines.find(d => d.id === id);
            if (!deadline) return;

            try {
                const { error } = await supabase
                    .from('deadlines')
                    .update({ completed: !deadline.completed })
                    .eq('id', id)
                    .eq('user_id', currentUser.id);

                if (error) {
                    errorLog('Erro ao atualizar prazo:', error);
                    showConnectionStatus('‚ùå Erro ao atualizar: ' + error.message, 'error');
                    return;
                }

                await loadDeadlines();
                showConnectionStatus('‚úÖ Prazo atualizado!', 'success');
            } catch (error) {
                errorLog('Erro ao atualizar prazo:', error);
                showConnectionStatus('‚ùå Erro de conex√£o: ' + error.message, 'error');
            }
        };

        window.deleteDeadline = async function(id) {
            if (!confirm('Tem certeza que deseja excluir este prazo?')) return;

            try {
                const { error } = await supabase
                    .from('deadlines')
                    .delete()
                    .eq('id', id)
                    .eq('user_id', currentUser.id);

                if (error) {
                    errorLog('Erro ao excluir prazo:', error);
                    showConnectionStatus('‚ùå Erro ao excluir: ' + error.message, 'error');
                    return;
                }

                await loadDeadlines();
                showConnectionStatus('‚úÖ Prazo exclu√≠do com sucesso!', 'success');
            } catch (error) {
                errorLog('Erro ao excluir prazo:', error);
                showConnectionStatus('‚ùå Erro de conex√£o: ' + error.message, 'error');
            }
        };

        // ===== SERVICE WORKER PARA PWA =====
        
        if ('serviceWorker' in navigator) {
            // Criar Service Worker inline como blob
            const swCode = `
                const CACHE_NAME = 'deadlinex-v2.1';
                const urlsToCache = ['/'];

                self.addEventListener('install', event => {
                    console.log('SW: Installing...');
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => {
                                console.log('SW: Cache opened');
                                return cache.addAll(urlsToCache);
                            })
                            .catch(err => console.log('SW: Cache error:', err))
                    );
                });

                self.addEventListener('fetch', event => {
                    // S√≥ cachear requests GET
                    if (event.request.method !== 'GET') return;
                    
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => {
                                if (response) {
                                    return response;
                                }
                                return fetch(event.request);
                            })
                            .catch(err => {
                                console.log('SW: Fetch error:', err);
                                return new Response('Offline', { status: 503 });
                            })
                    );
                });

                self.addEventListener('notificationclick', event => {
                    console.log('SW: Notification clicked');
                    event.notification.close();
                    
                    if (event.action === 'view') {
                        event.waitUntil(
                            clients.openWindow(self.location.origin)
                        );
                    }
                });

                self.addEventListener('activate', event => {
                    console.log('SW: Activating...');
                    event.waitUntil(
                        caches.keys().then(cacheNames => {
                            return Promise.all(
                                cacheNames.map(cacheName => {
                                    if (cacheName !== CACHE_NAME) {
                                        console.log('SW: Deleting old cache:', cacheName);
                                        return caches.delete(cacheName);
                                    }
                                })
                            );
                        })
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(registration => {
                    console.log('‚úÖ Service Worker registrado:', registration.scope);
                    
                    // Limpar URL do blob ap√≥s registro
                    URL.revokeObjectURL(swUrl);
                })
                .catch(error => {
                    console.log('‚ùå Erro ao registrar Service Worker:', error);
                    URL.revokeObjectURL(swUrl);
                });
        }

        // ===== INICIALIZA√á√ÉO =====
        
        async function initializeApp() {
            console.log(`üöÄ Inicializando ${SYSTEM_VERSION}...`);
            
            const dbReady = await initializeDatabase();
            if (dbReady) {
                await loadDeadlines();
            }
            
            // Solicitar permiss√£o de notifica√ß√£o automaticamente
            if ('Notification' in window && Notification.permission === 'default') {
                setTimeout(() => {
                    requestNotificationPermission();
                }, 2000);
            }
        }

        // Verificar se usu√°rio j√° est√° logado
        document.addEventListener('DOMContentLoaded', async () => {
            debugLog('=== INICIALIZANDO APLICA√á√ÉO ===');
            
            try {
                const { data: { session } } = await supabase.auth.getSession();
                
                if (session?.user) {
                    currentUser = session.user;
                    debugLog('Usu√°rio logado encontrado:', currentUser);
                    
                    const userName = currentUser.user_metadata?.name || currentUser.email;
                    elements.userWelcome.textContent = `Ol√°, ${userName}!`;
                    elements.loginScreen.classList.add('hidden');
                    elements.mainApp.classList.remove('hidden');
                    
                    await initializeApp();
                } else {
                    debugLog('Nenhum usu√°rio logado encontrado');
                }
            } catch (error) {
                errorLog('Erro ao verificar sess√£o:', error);
            }
        });

        // ===== FUN√á√ïES DE DIAGN√ìSTICO (PARA DESENVOLVIMENTO) =====
        
        window.diagnoseSystem = function() {
            console.log('üîç DIAGN√ìSTICO COMPLETO DO SISTEMA');
            console.log('==================================');
            console.log('Vers√£o:', SYSTEM_VERSION);
            console.log('Usu√°rio atual:', currentUser);
            console.log('Prazos carregados:', deadlines.length);
            console.log('Supabase conectado:', !!supabase);
            console.log('Notifica√ß√µes:', Notification.permission);
            console.log('Service Worker:', 'serviceWorker' in navigator);
            console.log('PWA instal√°vel:', !!deferredPrompt);
            
            // Testar conex√£o com Supabase
            if (supabase && currentUser) {
                console.log('üß™ TESTANDO CONEX√ÉO COM SUPABASE...');
                supabase.from('deadlines').select('count', { count: 'exact', head: true })
                    .then(result => {
                        console.log('‚úÖ Teste de conex√£o Supabase:', result);
                    })
                    .catch(error => {
                        console.log('‚ùå Erro no teste de conex√£o Supabase:', error);
                    });
            }
        };

        // Disponibilizar globalmente
        window.deadlineXSystem = {
            version: SYSTEM_VERSION,
            diagnose: window.diagnoseSystem,
            currentUser: () => currentUser,
            deadlines: () => deadlines
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9780ec1b66f6a178',t:'MTc1NjY4OTM4Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>










